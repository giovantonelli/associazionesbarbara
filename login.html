<!DOCTYPE html>
<html lang="it">
<head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Associazione Santa Barbara | Login</title>
  <meta name="description" content="Accedi al tuo account dell'Associazione Santa Barbara">
  <meta name="keywords" content="login, accesso, associazione santa barbara">
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
  <!-- SVG favicon removed for optimization -->
  <link rel="shortcut icon" href="favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="S.Barbara" />
  <!-- Manifest removed for optimization -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "Associazione Santa Barbara",
  "image": "assets/images/logo.png",
    "@id": "https://associazionesbarbara.it/",
    "url": "https://associazionesbarbara.it/",
    "telephone": "+39 333 289 3715",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Via Nicola Mastroserio 12",
      "addressLocality": "Grumo Appula",
      "addressRegion": "BA",
      "postalCode": "70025",
      "addressCountry": "IT"
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": "41.0036",
      "longitude": "16.7032"
    },
    "email": "info@associazionesbarbara.it",
    "description": "Associazione culturale e sociale attiva dal 2008 a Grumo Appula (BA), promuove tradizioni, cultura e solidarietà."
  }
  </script>
  <script src="assets/js/analytics.js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <div class="nav-brand">
        <a href="index.html" class="nav-brand-link"><img src="favicon/favicon.ico" alt="Logo Associazione Santa Barbara" class="logo"> <span class="brand-text">Associazione Santa Barbara</span></a>
      </div>
      <button class="nav-toggle" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <ul class="nav-menu">
        <li>
          <a href="index.html" class="nav-link">Home</a>
        </li>
        <li>
          <a href="chi-siamo.html" class="nav-link">Chi siamo</a>
        </li>
        <li>
          <a href="attivita.html" class="nav-link">Attività</a>
        </li>
        <li>
          <a href="eventi.html" class="nav-link">Eventi</a>
        </li>
        <li>
          <a href="galleria.html" class="nav-link">Galleria</a>
        </li>
        <li>
          <a href="faq.html" class="nav-link">FAQ</a>
        </li>
        <li>
          <a href="partner.html" class="nav-link">Partner</a>
        </li>
        <li>
          <a href="contatti.html" class="nav-link">Contatti</a>
        </li>
        <li>
          <a href="area-soci.html" class="nav-link btn btn-primary">Area Soci</a>
        </li>
      </ul>
    </div>
  </nav>
  <div id="user-bar"></div>
  <section class="auth-section">
    <div class="container">
      <div class="auth-container">
        <div class="auth-header">
          <h1>Accedi al tuo Account</h1>
          <p>Inserisci le tue credenziali per accedere all'area riservata</p>
        </div>
        <div class="auth-form-container">
          <form id="loginForm" class="auth-form" data-type="login" name="loginForm">
            <div class="form-group">
              <label for="email">Email</label> <input type="email" id="email" name="email" required autocomplete="username">
            </div>
            <div class="form-group">
              <label for="password">Password</label> <input type="password" id="password" name="password" required autocomplete="current-password">
            </div><button type="submit" class="btn btn-primary btn-full" id="loginButton"><span class="btn-text">Accedi</span></button>
            <div class="loading-spinner" style="display: none;"></div>
          </form>
          <div id="statusMessage" class="status-message" style="display: none;"></div>
          <div id="resendEmailSection" class="resend-email-section" style="display: none; margin: 15px 0;">
            <p class="text-center" style="color: #666; margin-bottom: 10px;">Non hai ricevuto l'email di conferma?</p>
            <button type="button" id="resendEmailBtn" class="btn btn-secondary btn-full">
              <span class="btn-text">Invia di nuovo email di conferma</span>
              <div class="loading-spinner" style="display: none;"></div>
            </button>
          </div>
          <div class="auth-links">
            <p>Non hai un account? <a href="register.html">Registrati qui</a></p>
            <p><a href="index.html">◀ Torna alla Home</a></p>
          </div>
        </div>
      </div>
    </div>
  </section>
    <footer class="footer enhanced-footer">
    <div class="container">
      <!-- Sezione principale del footer -->
      <div class="footer-main">
        <div class="footer-brand brand-card">
          <img src="favicon/favicon.ico" alt="Associazione Santa Barbara" class="footer-logo">
          <h4>Associazione Santa Barbara</h4>
          <p>
            Preserviamo le tradizioni di Grumo Appula dal 2008 con il Corteo Storico e attività culturali che valorizzano il nostro patrimonio.
          </p>
          <div class="contact-info-footer">
            <p>
              <span>📍</span> Via N. Mastroserio 12 - Grumo Appula (BA)
            </p>
            <p>
              <span>📧</span> <a href="mailto:info@associazionesbarbara.it">info@associazionesbarbara.it</a>
            </p>
            <p>
              <b>Contattaci per maggiori informazioni</b>
            </p>
          </div>
        </div>

        <div class="footer-sections">
          <div class="footer-section links-card">
            <div>
              <h4>🔗 Link Utili</h4>
              <ul>
                <li>
                  <a href="chi-siamo.html">
                    <span>▶</span> Chi siamo
                  </a>
                </li>
                <li>
                  <a href="eventi.html">
                    <span>▶</span> Eventi
                  </a>
                </li>
                <li>
                  <a href="galleria.html">
                    <span>▶</span> Galleria
                  </a>
                </li>
                <li>
                  <a href="attivita.html">
                    <span>▶</span> Attività
                  </a>
                </li>
                <li>
                  <a href="faq.html">
                    <span>▶</span> FAQ
                  </a>
                </li>
              </ul>
            </div>
            
            <div class="social-section">
              <p>🌐 Seguici sui social:</p>
              <div class="social-links">
                <a href="https://www.facebook.com/s.barbaragrumo" class="enhanced-social" rel="nofollow" aria-label="Facebook">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentcolor">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path>
                  </svg>
                </a>
                <a href="https://www.instagram.com/corteostoricosantabarbara/" class="enhanced-social" rel="nofollow" aria-label="Instagram">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentcolor">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.40s-.644-1.44-1.439-1.40z"></path>
                  </svg>
                </a>
                <a href="https://t.me/associazionesbarbara" class="enhanced-social" rel="nofollow" aria-label="Telegram">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentcolor">
                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"></path>
                  </svg>
                </a>
              </div>
              <div class="secondary-links">
                <a href="privacy.html">Privacy</a>
                <a href="partner.html">Partner</a>
                <a href="area-soci.html">Area Soci</a>
              </div>
            </div>
          </div>

          <div class="footer-section support-section">
            <h4>🤝 Sostieni l'Associazione</h4>
            <p>
              Aiutaci a preservare le tradizioni e organizzare eventi per la comunità. Il tuo supporto è fondamentale per mantenere viva la storia e la cultura di Grumo Appula.
            </p>
            <p>
              Con il tuo contributo possiamo continuare a organizzare il Corteo Storico, eventi culturali, iniziative educative e progetti per valorizzare il nostro patrimonio storico-artistico.
            </p>
            <p>
              <strong>Ogni donazione, grande o piccola, fa la differenza!</strong> Insieme possiamo costruire un futuro migliore per la nostra comunità.
            </p>
            <div class="sponsor-btn-container">
              <a href="contatti.html" class="sponsor-btn">
                ❤️ Diventa Sponsor
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2008 - <span id="current-year"></span> Associazione Santa Barbara APS. Tutti i diritti riservati.<br>
        <span class="privacy-links"><a href="privacy.html">PRIVACY POLICY</a> <span class="separator">|</span> <a href="#" onclick="window.cookieConsent && window.cookieConsent.open(); return false;">GESTISCI COOKIE</a></span></p>
      </div>
    </div>
  </footer>
  <div id="cookie-banner" class="cookie-banner">
    <div class="cookie-content">
      <p>Questo sito utilizza cookie per migliorare la tua esperienza. Continuando la navigazione accetti l'uso dei cookie.</p>
      <div class="cookie-actions">
        <button id="cookie-accept" class="btn btn-primary">Accetta</button> <button id="cookie-decline" class="btn btn-secondary">Rifiuta</button> <a href="privacy.html" class="btn btn-link">Informativa Privacy</a>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> 
  <script src="assets/js/notifications.js"></script> 
  <script src="assets/js/script.js"></script> 
  <script>

                        // Use global Supabase client instance
                        const supabaseClient = window.getSupabaseClient();
                        // DOM Elements
                        const loginForm = document.getElementById('loginForm');
                        const emailInput = document.getElementById('email');
                        const passwordInput = document.getElementById('password');
                        const loginButton = document.getElementById('loginButton');
                        const statusMessage = document.getElementById('statusMessage');
                        const btnText = loginButton.querySelector('.btn-text');
                        const loadingSpinner = document.querySelector('.auth-form .loading-spinner');
                        // Utility Functions
                        function showStatus(message, type = 'info') {
                                statusMessage.className = `status-message ${type}`;
                                statusMessage.innerHTML = message;
                                statusMessage.style.display = 'block';
                        }

                        function hideStatus() {
                                statusMessage.style.display = 'none';
                        }

                        function setLoading(isLoading) {
                                if (isLoading) {
                                        btnText.style.display = 'none';
                                        loadingSpinner.style.display = 'block';
                                        loginButton.disabled = true;
                                } else {
                                        btnText.style.display = 'block';
                                        loadingSpinner.style.display = 'none';
                                        loginButton.disabled = false;
                                }
                        }
                        // Check if user is already logged in
                        async function checkExistingSession() {
                                try {
                                        const {
                                                data: {
                                                        session
                                                },
                                                error
                                        } = await supabaseClient.auth.getSession();
                                        if (error) {
                                                console.error('Error checking session:', error);
                                                return;
                                        }
                                        if (session) {
                                                // User is already logged in, redirect to area soci
                                                showStatus('Sessione esistente trovata, reindirizzamento...', 'success');
                                                setTimeout(() => {
                                                        window.location.href = 'area-soci.html';
                                                }, 1000);
                                        }
                                } catch (error) {
                                        console.error('Error checking existing session:', error);
                                }
                        }
                        // Login Function
                        async function handleLogin(event) {
                                event.preventDefault();
                                hideStatus();
                                const email = emailInput.value.trim();
                                const password = passwordInput.value;
                                // Validation
                                if (!email || !password) {
                                        showStatus('Inserisci email e password.', 'error');
                                        return;
                                }
                                if (!email.includes('@')) {
                                        showStatus('Inserisci un indirizzo email valido.', 'error');
                                        return;
                                }
                                setLoading(true);
                                try {
                                        // Sign in with Supabase
                                        const {
                                                data,
                                                error
                                        } = await supabaseClient.auth.signInWithPassword({
                                                email: email,
                                                password: password
                                        });
                                        if (error) {
                                                throw error;
                                        }
                                        if (data.user) {
                                                // Check if email is confirmed
                                                if (!data.user.email_confirmed_at) {
                                                        showStatus('Email non confermata. Controlla la tua casella di posta e clicca sul link di conferma.', 'warning');
                                                        setLoading(false);
                                                        return;
                                                }
                                                showStatus('Login effettuato con successo! Reindirizzamento...', 'success');
                                                // Redirect to area soci after successful login
                                                setTimeout(() => {
                                                        window.location.href = 'area-soci.html';
                                                }, 1500);
                                        } else {
                                                throw new Error('Errore durante il login');
                                        }
                                } catch (error) {
                                        console.error('Login error:', error);
                                        let errorMessage = 'Errore durante il login. ';
                                        if (error.message.includes('Invalid login credentials')) {
                                                errorMessage = 'Email o password non corretti.';
                                        } else if (error.message.includes('Email not confirmed')) {
                                                errorMessage = 'Email non confermata. Controlla la tua casella di posta.';
                                                // Show resend email section when email is not confirmed
                                                document.getElementById('resendEmailSection').style.display = 'block';
                                        } else if (error.message.includes('Too many requests')) {
                                                errorMessage = 'Troppi tentativi di login. Riprova tra qualche minuto.';
                                        } else {
                                                errorMessage += error.message;
                                        }
                                        showStatus(errorMessage, 'error');
                                } finally {
                                        setLoading(false);
                                }
                        }
                        // Resend verification email function
                        async function resendVerificationEmail() {
                                const email = emailInput.value.trim();
                                
                                if (!email) {
                                        showStatus('Inserisci il tuo indirizzo email prima di richiedere una nuova email di conferma.', 'error');
                                        return;
                                }

                                const resendBtn = document.getElementById('resendEmailBtn');
                                const btnText = resendBtn.querySelector('.btn-text');
                                const spinner = resendBtn.querySelector('.loading-spinner');
                                
                                console.log('Resending email for:', email);
                                console.log('Button elements:', { resendBtn, btnText, spinner });
                                
                                // Set loading state
                                btnText.textContent = 'Invio in corso...';
                                if (spinner) {
                                    spinner.style.display = 'inline-block';
                                }
                                resendBtn.disabled = true;

                                try {
                                        const { error } = await supabaseClient.auth.resend({
                                                type: 'signup',
                                                email: email
                                        });

                                        if (error) {
                                                console.error('Supabase resend error:', error);
                                                throw error;
                                        }

                                        console.log('Email resend successful');
                                        showStatus('Email di conferma inviata! Controlla la tua casella di posta.', 'success');
                                        
                                } catch (error) {
                                        console.error('Resend email error:', error);
                                        let errorMessage = 'Errore durante l\'invio dell\'email. ';
                                        
                                        if (error.message.includes('User not found')) {
                                                errorMessage = 'Email non trovata. Verifica di aver inserito l\'email corretta.';
                                        } else if (error.message.includes('Email rate limit')) {
                                                errorMessage = 'Limite di invio raggiunto. Riprova tra qualche minuto.';
                                        } else {
                                                errorMessage += error.message;
                                        }
                                        
                                        showStatus(errorMessage, 'error');
                                } finally {
                                        // Reset button state
                                        btnText.textContent = 'Invia di nuovo email di conferma';
                                        if (spinner) {
                                            spinner.style.display = 'none';
                                        }
                                        resendBtn.disabled = false;
                                        console.log('Resend operation completed');
                                }
                        }

                        // Hide resend section when form is focused again
                        function hideResendSection() {
                                document.getElementById('resendEmailSection').style.display = 'none';
                        }

                        // Event Listeners
                        loginForm.addEventListener('submit', handleLogin);
                        document.getElementById('resendEmailBtn').addEventListener('click', resendVerificationEmail);
                        
                        // Hide resend section when user starts typing again
                        emailInput.addEventListener('focus', hideResendSection);
                        passwordInput.addEventListener('focus', hideResendSection);
                        
                        // Check for email verification success
                        function checkEmailVerification() {
                                const urlParams = new URLSearchParams(window.location.search);
                                if (urlParams.get('verified') === 'true') {
                                        showStatus('✓ Email verificata con successo! Ora puoi effettuare il login.', 'success');
                                        // Remove the parameter from URL
                                        window.history.replaceState({}, document.title, window.location.pathname);
                                }
                        }

                        // Check for existing session on page load
                        document.addEventListener('DOMContentLoaded', checkExistingSession);
                        document.addEventListener('DOMContentLoaded', checkEmailVerification);
                        // Auto-focus email field
                        document.addEventListener('DOMContentLoaded', () => {
                                emailInput.focus();
                        });
  </script> 
  <script src="assets/js/adblock-detector-v2.js"></script> 
  <script src="assets/js/adblock-integration-v2.js"></script>
</body>
</html>

