<!DOCTYPE html>
<html lang="it">
<head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.8.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Associazione Santa Barbara | Area Soci</title>
  <meta name="description" content="Accesso riservato ai soci dell'Associazione Santa Barbara">
  <meta name="keywords" content="area soci, login, accesso riservato, associazione">
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="icon" type="image/png" href="{{FAVICON_96_BASE64}}" sizes="96x96" />
  <!-- SVG favicon removed for optimization -->
  <!-- <link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" /> -->
  <link rel="shortcut icon" href="{{FAVICON_ICO_BASE64}}" />
  <link rel="apple-touch-icon" sizes="180x180" href="data:image/png;base64,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" />
  <meta name="apple-mobile-web-app-title" content="S.Barbara" />
  <!-- Manifest removed for optimization -->
  <!-- <link rel="manifest" href="favicon/site.webmanifest" /> -->
  <script src="assets/js/analytics.js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <div class="nav-brand">
        <a href="index.html" class="nav-brand-link"><img src="{{FAVICON_ICO_BASE64}}" alt="Logo Associazione Santa Barbara" class="logo"> <span class="brand-text">Associazione Santa Barbara</span></a>
      </div>
      <button class="nav-toggle" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <ul class="nav-menu">
        <li>
          <a href="index.html" class="nav-link">Home</a>
        </li>
        <li>
          <a href="chi-siamo.html" class="nav-link">Chi siamo</a>
        </li>
        <li>
          <a href="attivita.html" class="nav-link">Attività</a>
        </li>
        <li>
          <a href="eventi.html" class="nav-link">Eventi</a>
        </li>
        <li>
          <a href="galleria.html" class="nav-link">Galleria</a>
        </li>
        <li>
          <a href="faq.html" class="nav-link">FAQ</a>
        </li>
        <li>
          <a href="contatti.html" class="nav-link">Contatti</a>
        </li>
        <li>
          <a href="partner.html" class="nav-link">Partner</a>
        </li>
        <li>
          <a id="logout-btn" class="btn btn-secondary">🚪 Logout</a>
        </li>
      </ul>
    </div>
  </nav>
  <section class="page-header">
    <div class="container">
      <h1>Area Soci</h1>
      <p>Accesso riservato ai soci dell'associazione</p>
    </div>
  </section>
  <div id="cookie-banner" class="cookie-banner">
    <div class="cookie-content">
      <p>Questo sito utilizza cookie per migliorare la tua esperienza. Continuando la navigazione accetti l'uso dei cookie.</p>
      <div class="cookie-actions">
        <button id="cookie-accept" class="btn btn-primary">Accetta</button> <button id="cookie-decline" class="btn btn-secondary">Rifiuta</button> <a href="privacy.html" class="btn btn-link">Informativa Privacy</a>
      </div>
    </div>
  </div>
  <section id="members-content" class="members-content" style="display:none;">
    <div class="container">
      <div id="user-info" class="user-info"></div>
      <div class="content-section" style="margin-top: 30px;">
        <h3>👤 Gestione Profilo</h3>
        <p>Gestisci i tuoi dati e le preferenze dell'account</p>
        <div class="profile-management">
          <div class="profile-actions">
            <button id="edit-profile-btn" class="btn btn-outline">✏️ Modifica Profilo</button> <button id="change-password-btn" class="btn btn-outline">🔐 Cambia Password</button> <button id="change-email-btn" class="btn btn-outline">📧 Cambia Email</button>
          </div>
        </div>
      </div>
      <div id="profile-edit-form" class="content-section" style="display: none; margin-top: 20px;">
        <h3>✏️ Modifica Profilo</h3>
        <form id="update-profile-form" name="update-profile-form">
          <div class="form-grid">
            <div class="form-group">
              <label for="edit-firstName">Nome *</label> <input type="text" id="edit-firstName" name="firstName" required="">
            </div>
            <div class="form-group">
              <label for="edit-lastName">Cognome *</label> <input type="text" id="edit-lastName" name="lastName" required="">
            </div>
            <div class="form-group">
              <label for="edit-dateOfBirth">Data di Nascita</label> <input type="date" id="edit-dateOfBirth" name="dateOfBirth">
            </div>
            <div class="form-group">
              <label for="edit-placeOfBirth">Luogo di Nascita</label> <input type="text" id="edit-placeOfBirth" name="placeOfBirth">
            </div>
            <div class="form-group">
              <label for="edit-gender">Sesso *</label> <select id="edit-gender" name="gender" required="" class="form-input">
                <option value="">
                  Seleziona...
                </option>
                <option value="M">
                  Maschio
                </option>
                <option value="F">
                  Femmina
                </option>
              </select>
            </div>
            <div class="form-group">
              <label for="edit-fiscalCode">Codice Fiscale</label> <input type="text" id="edit-fiscalCode" name="fiscalCode" pattern="[A-Z0-9]{16}" title="16 caratteri alfanumerici" style="text-transform: uppercase;">
            </div>
            <div class="form-group">
              <label for="edit-phone">Telefono</label> <input type="tel" id="edit-phone" name="phone">
            </div>
            <div class="form-group">
              <label for="edit-address">Indirizzo</label> <input type="text" id="edit-address" name="address">
            </div>
            <div class="form-group">
              <label for="edit-city">Citt�</label> <input type="text" id="edit-city" name="city">
            </div>
            <div class="form-group">
              <label for="edit-zipCode">CAP</label> <input type="text" id="edit-zipCode" name="zipCode" pattern="[0-9]{5}" title="5 cifre" maxlength="5">
            </div>
            <div class="form-group">
              <label for="edit-province">Provincia</label> <input type="text" id="edit-province" name="province" pattern="[A-Z]{2}" title="2 lettere maiuscole" maxlength="2" style="text-transform: uppercase;">
            </div>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">?? Salva Modifiche</button> <button type="button" id="cancel-edit-btn" class="btn btn-secondary">? Annulla</button>
          </div>
        </form>
      </div>
      <div id="password-change-form" class="content-section" style="display: none; margin-top: 20px;">
        <h3>?? Cambia Password</h3>
        <form id="update-password-form" name="update-password-form">
          <input type="text" id="username-for-password" name="username" autocomplete="username" value="" style="display:none;">
          <div class="form-group">
            <label for="current-password">Password Attuale *</label> <input type="password" id="current-password" name="currentPassword" required="" autocomplete="current-password">
          </div>
          <div class="form-group">
            <label for="new-password">Nuova Password *</label> <input type="password" id="new-password" name="newPassword" required="" minlength="8" autocomplete="new-password">
          </div>
          <div class="form-group">
            <label for="confirm-password">Conferma Nuova Password *</label> <input type="password" id="confirm-password" name="confirmPassword" required="" minlength="8" autocomplete="new-password">
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">?? Cambia Password</button> <button type="button" id="cancel-password-btn" class="btn btn-secondary">? Annulla</button>
          </div>
        </form>
      </div>
      <div id="email-change-form" class="content-section" style="display: none; margin-top: 20px;">
        <h3>?? Cambia Email</h3>
        <form id="update-email-form" name="update-email-form">
          <div class="form-group">
            <label for="current-email">Email Attuale</label> <input type="email" id="current-email" name="currentEmail" readonly>
          </div>
          <div class="form-group">
            <label for="new-email">Nuova Email *</label> <input type="email" id="new-email" name="newEmail" required="">
          </div>
          <div class="form-group">
            <label for="confirm-new-email">Conferma Nuova Email *</label> <input type="email" id="confirm-new-email" name="confirmNewEmail" required="">
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">?? Cambia Email</button> <button type="button" id="cancel-email-btn" class="btn btn-secondary">? Annulla</button>
          </div>
        </form>
      </div>
      
      <!-- Eventi Management Section -->
      <div class="content-section" style="margin-top: 30px;">
        <h3>?? Gestione Eventi</h3>
        <p>Crea, modifica o elimina eventi dell'associazione</p>
        
        <div class="events-management">
          <div class="management-tabs">
            <button id="show-events-list" class="btn btn-primary active-tab">?? Lista Eventi</button>
            <button id="show-create-event" class="btn btn-outline">? Nuovo Evento</button>
          </div>
          
          <!-- Lista Eventi -->
          <div id="events-list-section" class="management-section" style="margin-top: 20px;">
            <div id="events-table-container">
              <div class="table-responsive">
                <table id="admin-events-table" class="admin-table" style="width: 100%; border-collapse: collapse; background: white; table-layout: auto;">
                  <thead>
                    <tr style="background: #f8f9fa;">
                      <th style="padding: 12px; border: 1px solid #ddd; width: auto; min-width: 200px;">Titolo</th>
                      <th style="padding: 12px; border: 1px solid #ddd; width: auto; min-width: 100px; white-space: nowrap; text-align: center;">Data</th>
                      <th style="padding: 12px; border: 1px solid #ddd; width: auto; min-width: 120px; text-align: center;">Luogo</th>
                      <th style="padding: 12px; border: 1px solid #ddd; width: auto; min-width: 80px; text-align: center;">Pubblico</th>
                      <th style="padding: 12px; border: 1px solid #ddd; width: auto; min-width: 150px; text-align: center;">Azioni</th>
                    </tr>
                  </thead>
                  <tbody id="admin-events-tbody" style="border: 1px solid #ddd;">
                    <!-- Eventi caricati dinamicamente -->
                  </tbody>
                </table>
              </div>
              <div id="no-events-message" style="display: none; text-align: center; padding: 20px; color: #666;">
                Nessun evento trovato.
              </div>
            </div>
          </div>
          
          <!-- Form Creazione/Modifica Evento -->
          <div id="event-form-section" class="management-section" style="display: none; margin-top: 20px;">
            <div class="form-container">
              <h4 id="event-form-title">? Nuovo Evento</h4>
              <form id="event-management-form" name="event-management-form">
                <input type="hidden" id="event-id" name="eventId">
                
                <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                  <div class="form-group">
                    <label for="event-title">Titolo Evento *</label>
                    <input type="text" id="event-title" name="title" required maxlength="255" class="form-input">
                  </div>
                  
                  <div class="form-group">
                    <label for="event-date">Data Evento *</label>
                    <input type="date" id="event-date" name="event_date" required class="form-input">
                  </div>
                  
                  <div class="form-group">
                    <label for="event-time">Orario</label>
                    <input type="text" id="event-time" name="event_time" placeholder="es. 18:00" class="form-input">
                  </div>
                  
                  <div class="form-group">
                    <label for="event-location">Luogo</label>
                    <input type="text" id="event-location" name="location" maxlength="255" class="form-input">
                  </div>
                  
                  <div class="form-group">
                    <label for="event-address">Indirizzo</label>
                    <input type="text" id="event-address" name="address" maxlength="500" class="form-input">
                  </div>
                  
                  <div class="form-group">
                    <label for="event-image-url">URL Immagine</label>
                    <input type="url" id="event-image-url" name="image_url" class="form-input" placeholder="https://...">
                  </div>
                  
                  <div class="form-group">
                    <label for="event-created-by">Creato da</label>
                    <select id="event-created-by" name="created_by" class="form-input">
                      <option value="">Seleziona utente...</option>
                      <!-- Opzioni caricate dinamicamente -->
                    </select>
                  </div>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                  <label for="event-description">Descrizione Breve</label>
                  <textarea id="event-description" name="description" rows="3" maxlength="500" class="form-input" placeholder="Descrizione breve dell'evento..."></textarea>
                </div>
                
                <div class="form-group">
                  <label for="event-content">Contenuto Completo</label>
                  <textarea id="event-content" name="content" rows="6" class="form-input" placeholder="Contenuto dettagliato dell'evento (supporta HTML)..."></textarea>
                </div>
                
                <div class="form-group">
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="event-is-public" name="is_public" checked>
                      <span class="checkmark"></span>
                      Evento pubblico
                    </label>
                  </div>
                </div>
                
                <div class="form-actions" style="margin-top: 25px;">
                  <button type="submit" id="save-event-btn" class="btn btn-primary">?? Salva Evento</button>
                  <button type="button" id="cancel-event-form" class="btn btn-secondary">? Annulla</button>
                  <button type="button" id="delete-event-btn" class="btn btn-danger" style="display: none;">??? Elimina Evento</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      
      <!-- User Management Section -->
      <div class="content-section" style="margin-top: 30px;">
        <h3>?? Gestione Utenti</h3>
        <p>Gestisci gli utenti registrati e i loro ruoli</p>
        
        <div class="users-management">
          <div class="management-tabs">
            <button id="show-users-list" class="btn btn-primary active-tab">?? Lista Utenti</button>
          </div>
          
          <!-- Users List Tab -->
          <div id="users-list-tab" class="tab-content">
            <div class="users-table-container" style="margin-top: 20px;">
              <div id="users-table" class="table-container" style="overflow-x: auto;">
                <p style="text-align: center; padding: 20px; color: #666;">Caricamento utenti...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
    <footer class="footer enhanced-footer">
    <div class="container">
      <!-- Sezione principale del footer -->
      <div class="footer-main">
        <div class="footer-brand brand-card">
          <img src="favicon/favicon.ico" alt="Associazione Santa Barbara" class="footer-logo">
          <h4>Associazione Santa Barbara</h4>
          <p>
            Preserviamo le tradizioni di Grumo Appula dal 2008 con il Corteo Storico e attività culturali che valorizzano il nostro patrimonio.
          </p>
          <div class="contact-info-footer">
            <p>
              <span>📍</span> Via N. Mastroserio 12 - Grumo Appula (BA)
            </p>
            <p>
              <span>📧</span> <a href="mailto:info@associazionesbarbara.it">info@associazionesbarbara.it</a>
            </p>
            <p>
              <b>Contattaci per maggiori informazioni</b>
            </p>
          </div>
        </div>

        <div class="footer-sections">
          <div class="footer-section links-card">
            <div>
              <h4>🔗 Link Utili</h4>
              <ul>
                <li>
                  <a href="chi-siamo.html">
                    <span>▶</span> Chi siamo
                  </a>
                </li>
                <li>
                  <a href="eventi.html">
                    <span>▶</span> Eventi
                  </a>
                </li>
                <li>
                  <a href="galleria.html">
                    <span>▶</span> Galleria
                  </a>
                </li>
                <li>
                  <a href="attivita.html">
                    <span>▶</span> Attività
                  </a>
                </li>
                <li>
                  <a href="faq.html">
                    <span>▶</span> FAQ
                  </a>
                </li>
              </ul>
            </div>
            
            <div class="social-section">
              <p>🌐 Seguici sui social:</p>
              <div class="social-links">
                <a href="https://www.facebook.com/s.barbaragrumo" class="enhanced-social" rel="nofollow" aria-label="Facebook">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentcolor">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path>
                  </svg>
                </a>
                <a href="https://www.instagram.com/corteostoricosantabarbara/" class="enhanced-social" rel="nofollow" aria-label="Instagram">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentcolor">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.40s-.644-1.44-1.439-1.40z"></path>
                  </svg>
                </a>
                <a href="https://t.me/associazionesbarbara" class="enhanced-social" rel="nofollow" aria-label="Telegram">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentcolor">
                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"></path>
                  </svg>
                </a>
              </div>
              <div class="secondary-links">
                <a href="privacy.html">Privacy</a>
                <a href="partner.html">Partner</a>
                <a href="area-soci.html">Area Soci</a>
              </div>
            </div>
          </div>

          <div class="footer-section support-section">
            <h4>🤝 Sostieni l'Associazione</h4>
            <p>
              Aiutaci a preservare le tradizioni e organizzare eventi per la comunità. Il tuo supporto è fondamentale per mantenere viva la storia e la cultura di Grumo Appula.
            </p>
            <p>
              Con il tuo contributo possiamo continuare a organizzare il Corteo Storico, eventi culturali, iniziative educative e progetti per valorizzare il nostro patrimonio storico-artistico.
            </p>
            <p>
              <strong>Ogni donazione, grande o piccola, fa la differenza!</strong> Insieme possiamo costruire un futuro migliore per la nostra comunità.
            </p>
            <div class="sponsor-btn-container">
              <a href="contatti.html" class="sponsor-btn">
                ❤️ Diventa Sponsor
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2008 - <span id="current-year"></span> Associazione Santa Barbara APS. Tutti i diritti riservati.<br>
        <span class="privacy-links"><a href="privacy.html">PRIVACY POLICY</a> <span class="separator">|</span> <a href="#" onclick="window.cookieConsent && window.cookieConsent.open(); return false;">GESTISCI COOKIE</a></span></p>
      </div>
    </div>
  </footer>
  <script src="assets/js/notifications.js"></script> 
  <script src="assets/js/script.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> 
  <script>

                        // Use global Supabase client instance
                        const supabaseClient = window.getSupabaseClient();
                        // Global variables (currentUser is already declared in script.js)
                        let userRole = null;
                        // DOM Elements
                        const loadingScreen = document.getElementById('loading-screen');
                        const loginPrompt = document.getElementById('login-prompt');
                        const membersContent = document.getElementById('members-content');
                        const userInfo = document.getElementById('user-info');
                        const logoutBtn = document.getElementById('logout-btn');
                        // Utility Functions
                        function showLoading() {
                                if (loginPrompt) loginPrompt.style.display = 'none';
                                if (membersContent) membersContent.style.display = 'none';
                        }

                        function hideLoading() {
                                // Loading screen removed
                        }

                        function showLoginPrompt() {
                                hideLoading();
                                if (loginPrompt) loginPrompt.style.display = 'block';
                                if (membersContent) membersContent.style.display = 'none';
                        }

  function showMembersContent() {
        hideLoading();
        if (loginPrompt) loginPrompt.style.display = 'none';
        if (membersContent) {
                membersContent.style.display = 'block';
                membersContent.classList.add('show');
        }
        // Mostra tutte le sezioni riservate
        const dashboardSection = document.querySelector('.dashboard-section');
        if (dashboardSection) dashboardSection.style.display = 'block';
        document.querySelectorAll('.col-md-3').forEach(el => el.style.display = 'block');
        const membersEvents = document.querySelector('.members-events');
        if (membersEvents) membersEvents.style.display = 'block';
        const membersDocuments = document.querySelector('.members-documents');
        if (membersDocuments) membersDocuments.style.display = 'block';
  }

                function updateUserInfo(user, metadata) {
                        if (!userInfo) return;
                        
                        // Estrai tutte le informazioni disponibili
                        const role = metadata?.role || 'utente';
                        const firstName = metadata?.first_name || '';
                        const lastName = metadata?.last_name || '';
                        const fullName = metadata?.full_name || (firstName && lastName ? `${firstName} ${lastName}` : firstName || lastName || 'Utente');
                        const phoneNumber = metadata?.phone_number || metadata?.phone || '';
                        const dateOfBirth = metadata?.date_of_birth || '';
                        const placeOfBirth = metadata?.place_of_birth || '';
                        const gender = metadata?.gender || '';
                        const fiscalCode = metadata?.fiscal_code || '';
                        const address = metadata?.address || '';
                        const city = metadata?.city || '';
                        const zipCode = metadata?.zip_code || '';
                        const province = metadata?.province || '';
                        const membershipType1 = metadata?.membership_type1 || '';
                        const membershipType2 = metadata?.membership_type2 || '';
                        const membershipStatus = metadata?.membership_status || 'attivo';
                        const privacyAccepted = metadata?.privacy_accepted || false;
                        const createdAt = metadata?.created_at || user.created_at;
                        const membershipNumber = metadata?.membership_number || '';
                        const membershipDate = metadata?.membership_date || createdAt;
                        
                        // Formatta lo stato dell'iscrizione per la visualizzazione
                        const membershipStatusDisplay = membershipStatus.charAt(0).toUpperCase() + membershipStatus.slice(1);
                        const membershipStatusIcon = {
                                'attivo': '✓',
                                'sospeso': '⏸️', 
                                'scaduto': '⚠️',
                                'cancellato': '❌'
                        }[membershipStatus] || '❓';
                        
                        // Calcola giorni dall'ultimo accesso
                        const lastSignIn = new Date(user.last_sign_in_at || user.created_at);
                        const today = new Date();
                        const daysSinceLastAccess = Math.floor((today - lastSignIn) / (1000 * 60 * 60 * 24));
                        const lastAccessText = daysSinceLastAccess === 0 ? 'Oggi' : daysSinceLastAccess === 1 ? 'Ieri' : `${daysSinceLastAccess} giorni fa`;
                        
                        // Costruisci l'indirizzo completo se disponibile
                        const fullAddress = [address, city, zipCode, province].filter(Boolean).join(', ');
                        
                        userInfo.innerHTML = `
                                <div class="user-card">
                                        <div class="user-details">
                                                <h3>${fullName}</h3>
                                                <p class="user-email">📧 ${user.email}</p>
                                                ${phoneNumber ? `<p class="user-phone">📞 ${phoneNumber}</p>` : ''}
                                                ${fiscalCode ? `<p class="user-fiscal">🇨🇵 CF: ${fiscalCode}</p>` : ''}
                                                <span class="user-role ${role}">${role === 'socio' ? 'Socio' : role === 'admin' ? 'Amministratore' : 'Utente'}</span>
                                        </div>
                                </div>
                                
                                <div class="user-stats">
                                        <div class="stat">
                                                <span class="stat-label">Ultimo accesso</span>
                                                <span class="stat-value">${lastAccessText}</span>
                                        </div>
                                        <div class="stat">
                                                <span class="stat-label">Stato iscrizione</span>
                                                <span class="stat-value">${membershipStatusIcon} ${membershipStatusDisplay}</span>
                                        </div>
                                        ${membershipDate ? `
                                        <div class="stat">
                                                <span class="stat-label">Socio dal</span>
                                                <span class="stat-value">${new Date(membershipDate).toLocaleDateString('it-IT')}</span>
                                        </div>` : ''}
                                        ${membershipType1 || membershipType2 ? `
                                        <div class="stat">
                                                <span class="stat-label">Tipo socio</span>
                                                <span class="stat-value">${[membershipType1, membershipType2].filter(Boolean).join(' + ')}</span>
                                        </div>` : ''}
                                        ${membershipNumber ? `
                                        <div class="stat">
                                                <span class="stat-label">N. Tessera</span>
                                                <span class="stat-value">${membershipNumber}</span>
                                        </div>` : ''}
                                </div>
                                
                                ${dateOfBirth || placeOfBirth || gender || fullAddress ? `
                                <div class="user-additional-info" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2);">
                                        <h4 style="margin-bottom: 15px; color: rgba(255,255,255,0.9);">👤 Dati Personali</h4>
                                        ${dateOfBirth ? `
                                        <p style="margin-bottom: 10px; opacity: 0.9;">
                                                <strong>🎂 Data di nascita:</strong> ${new Date(dateOfBirth).toLocaleDateString('it-IT')}
                                        </p>` : ''}
                                        ${placeOfBirth ? `
                                        <p style="margin-bottom: 10px; opacity: 0.9;">
                                                <strong>🏠 Luogo di nascita:</strong> ${placeOfBirth}
                                        </p>` : ''}
                                        ${gender ? `
                                        <p style="margin-bottom: 10px; opacity: 0.9;">
                                                <strong>👥 Genere:</strong> ${gender === 'M' ? 'Maschio' : gender === 'F' ? 'Femmina' : gender}
                                        </p>` : ''}
                                        ${fullAddress ? `
                                        <p style="margin-bottom: 10px; opacity: 0.9;">
                                                <strong>📍 Indirizzo:</strong> ${fullAddress}
                                        </p>` : ''}
                                        ${privacyAccepted ? `
                                        <p style="margin-bottom: 10px; opacity: 0.9;">
                                                <strong>⚖️ Privacy:</strong> ✓ Accettata
                                        </p>` : `
                                        <p style="margin-bottom: 10px; opacity: 0.9; color: #ffeb3b;">
                                                <strong>⚖️ Privacy:</strong> ❌ Non accettata
                                        </p>`}
                                </div>` : ''}
                        `;
                        }
                        // Authentication Functions
                        async function checkAuthentication() {
                                showLoading();
                                try {
                                        // Get current session
                                        const {
                                                data: {
                                                        session
                                                },
                                                error
                                        } = await supabaseClient.auth.getSession();
                                        if (error) {
                                                console.error('Error checking session:', error);
                                                showLoginPrompt();
                                                return;
                                        }
                                        if (!session || !session.user) {
                                                // No active session, redirect to login
                                                setTimeout(() => {
                                                        window.location.href = 'login.html';
                                                }, 1000);
                                                return;
                                        }
                                        // Check if email is confirmed
                                        if (!session.user.email_confirmed_at) {
                                                showLoginPrompt();
                                                if (loginPrompt) {
                                                        loginPrompt.innerHTML = `
                                                        
                        
                        
                                                                        <div class="auth-prompt">
                                                                                <h2>?? Email non confermata</h2>
                                                                                <p>Il tuo account non � ancora stato confermato.</p>
                                                                                <p>Controlla la tua casella di posta e clicca sul link di conferma.</p>
                                                                                <div class="auth-actions">
                                                                                        <button onclick="resendConfirmation()" class="btn btn-primary">Invia di nuovo email</button>
                                                                                        <a href="login.html" class="btn btn-secondary">Torna al Login</a>
                                                                                </div>
                                                                        </div>
                                                `;
                                                }
                                                return;
                                        }
                                        // User is authenticated and confirmed
                                        currentUser = session.user;
                                        let userMetadata = session.user.user_metadata;
                                        userRole = userMetadata?.role || 'utente';
                                        // Try to fetch additional user profile data from profiles table
                                        try {
  const {
        data: profileData,
        error: profileError
  } = await supabaseClient.from('profiles').select('*').eq('id', session.user.id).single();
                                                if (!profileError && profileData) {
                                                        // Merge profile data with user metadata
                                                        userMetadata = {
                                                                ...userMetadata,
                                                                ...profileData
                                                        };
                                                        userRole = profileData.role || userMetadata?.role || 'utente';
                                                }
                                        } catch (profileError) {
                                                // Continue with just the metadata from auth
                                        }
                                        // Check if user has access (socio role)
                                        if (userRole !== 'socio') {
                                                showLoginPrompt();
                                                if (loginPrompt) {
                                                        loginPrompt.innerHTML = `
                                                        
                        
                        
                                                                        <div class="auth-prompt">
                                                                                <h2>?? Accesso Limitato</h2>
                                                                                <p>Il tuo account � attivo ma non hai i permessi per accedere all'area soci.</p>
                                                                                <p>Contatta l'amministrazione per richiedere l'attivazione come socio.</p>
                                                                                <div class="contact-info">
                                                                                        <p>?? 
                                                
                                                
                                                                                                <strong>Email:</strong> info@associazionesbarbara.it
                                        
                                        
                                                                                        </p>
                                                                                        <p>?? 
                                                
                                                
                                                                                                <strong>Sede:</strong> Via N. Mastroserio 12, Grumo Appula (BA)
                                        
                                        
                                                                                        </p>
                                                                                </div>
                                                                                <div class="auth-actions">
                                                                                        <button onclick="handleLogout()" class="btn btn-secondary">Logout</button>
                                                                                        <a href="index.html" class="btn btn-primary">Torna alla Home</a>
                                                                                </div>
                                                                        </div>
                                                `;
                                                }
                                                return;
                                        }
                                        // User has access, show members content
                                        updateUserInfo(currentUser, userMetadata);
                                        showMembersContent();
                                } catch (error) {
                                        console.error('Authentication check failed:', error);
                                        showLoginPrompt();
                                }
                        }
                        // Resend confirmation email
                        async function resendConfirmation() {
                                try {
                                        const {
                                                error
                                        } = await supabaseClient.auth.resend({
                                                type: 'signup',
                                                email: currentUser?.email
                                        });
                                        if (error) {
                                                notify.error('Errore nell\'invio dell\'email: ' + error.message);
                                        } else {
                                                notify.success('Email di conferma inviata! Controlla la tua casella di posta.');
                                        }
                                } catch (error) {
                                        console.error('Error resending confirmation:', error);
                                        notify.error('Errore nell\'invio dell\'email di conferma.');
                                }
                        }
                        // Logout function
                        async function handleLogout() {
                                try {
                                        const {
                                                error
                                        } = await supabaseClient.auth.signOut();
                                        if (error) {
                                                console.error('Logout error:', error);
                                                notify.error('Errore durante il logout: ' + error.message);
                                        } else {
                                                notify.info('Logout effettuato con successo. Arrivederci!');
                                                // Redirect to home page after successful logout
                                                setTimeout(() => {
                                                        window.location.href = 'index.html';
                                                }, 1000);
                                        }
                                } catch (error) {
                                        console.error('Logout failed:', error);
                                        notify.error('Errore durante il logout.');
                                }
                        }
                        // Auth state change listener
                        supabaseClient.auth.onAuthStateChange((event, session) => {
                                if (event === 'SIGNED_OUT' || !session) {
                                        // User signed out or session expired
                                        window.location.href = 'login.html';
                                } else if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {
                                        // User signed in or token refreshed
                                        checkAuthentication();
                                }
                        });
                        // Profile Management Functions

                        function hideAllForms() {
                                const editForm = document.getElementById('profile-edit-form');
                                const passwordForm = document.getElementById('password-change-form');
                                const emailForm = document.getElementById('email-change-form');
                                if (editForm) editForm.style.display = 'none';
                                if (passwordForm) passwordForm.style.display = 'none';
                                if (emailForm) emailForm.style.display = 'none';
                                // Rimuovi stato attivo da tutti i pulsanti
                                document.getElementById('edit-profile-btn')?.classList.remove('btn-active');
                                document.getElementById('change-password-btn')?.classList.remove('btn-active');
                                document.getElementById('change-email-btn')?.classList.remove('btn-active');
                        }

                        function showEditProfile() {
                                hideAllForms();
                                const editForm = document.getElementById('profile-edit-form');
                                const btn = document.getElementById('edit-profile-btn');
                                if (editForm) {
                                        editForm.style.display = 'block';
                                        populateEditForm();
                                }
                                if (btn) btn.classList.add('btn-active');
                        }

                        function hideEditProfile() {
                                const editForm = document.getElementById('profile-edit-form');
                                if (editForm) editForm.style.display = 'none';
                        }

                        function showChangePassword() {
                                hideAllForms();
                                const passwordForm = document.getElementById('password-change-form');
                                const btn = document.getElementById('change-password-btn');
                                if (passwordForm) passwordForm.style.display = 'block';
                                if (btn) btn.classList.add('btn-active');
                        }

                        function hideChangePassword() {
                                const passwordForm = document.getElementById('password-change-form');
                                if (passwordForm) passwordForm.style.display = 'none';
                        }

                        function showChangeEmail() {
                                hideAllForms();
                                const emailForm = document.getElementById('email-change-form');
                                const btn = document.getElementById('change-email-btn');
                                if (emailForm) emailForm.style.display = 'block';
                                if (btn) btn.classList.add('btn-active');
                        }
                        
                        function populateEditForm() {
                                if (!currentUser) return;
                                // Usa user_metadata gi� merge-ato con i dati del profilo (come fatto in checkAuthentication)
                                const metadata = currentUser.user_metadata || {};
                                // Informazioni Personali
                                document.getElementById('edit-firstName').value = metadata.first_name || '';
                                document.getElementById('edit-lastName').value = metadata.last_name || '';
                                document.getElementById('edit-dateOfBirth').value = metadata.date_of_birth || '';
                                document.getElementById('edit-placeOfBirth').value = metadata.place_of_birth || '';
                                document.getElementById('edit-gender').value = metadata.gender || '';
                                document.getElementById('edit-fiscalCode').value = metadata.fiscal_code || '';
                                // Contatti
                                document.getElementById('edit-phone').value = metadata.phone_number || metadata.phone || '';
                                // Indirizzo
                                document.getElementById('edit-address').value = metadata.address || '';
                                document.getElementById('edit-city').value = metadata.city || '';
                                document.getElementById('edit-zipCode').value = metadata.zip_code || '';
                                document.getElementById('edit-province').value = metadata.province || '';
                        }
                        
                        async function handleProfileUpdate(event) {
                                event.preventDefault();
                                
                                const submitBtn = event.target.querySelector('button[type="submit"]');
                                const originalText = submitBtn.innerHTML;
                                
                                // Show loading state
                                submitBtn.disabled = true;
                                submitBtn.innerHTML = '? Salvando...';
                                
                                const formData = new FormData(event.target);
                                
                                // Validate fiscal code format if provided
                                const fiscalCode = formData.get('fiscalCode')?.toUpperCase().trim();
                                if (fiscalCode && !/^[A-Z0-9]{16}$/.test(fiscalCode)) {
                                        notify.error('Il codice fiscale deve essere di 16 caratteri alfanumerici');
                                        submitBtn.disabled = false;
                                        submitBtn.innerHTML = originalText;
                                        return;
                                }
                                
                                // Validate ZIP code format if provided
                                const zipCode = formData.get('zipCode');
                                if (zipCode && !/^\d{5}$/.test(zipCode)) {
                                        notify.error('Il CAP deve essere di 5 cifre');
                                        submitBtn.disabled = false;
                                        submitBtn.innerHTML = originalText;
                                        return;
                                }
                                
                                // Validate province format if provided
                                const province = formData.get('province')?.toUpperCase().trim();
                                if (province && !/^[A-Z]{2}$/.test(province)) {
                                        notify.error('La provincia deve essere di 2 lettere maiuscole');
                                        submitBtn.disabled = false;
                                        submitBtn.innerHTML = originalText;
                                        return;
                                }
                                
                                const updateData = {
                                        // Informazioni Personali
                                        first_name: formData.get('firstName'),
                                        last_name: formData.get('lastName'),
                                        date_of_birth: formData.get('dateOfBirth') || null,
                                        place_of_birth: formData.get('placeOfBirth') || null,
                                        gender: formData.get('gender') || null,
                                        fiscal_code: fiscalCode || null,
                                        
                                        // Contatti
                                        phone_number: formData.get('phone') || null,
                                        phone: formData.get('phone') || null, // Keep both for compatibility
                                        
                                        // Indirizzo
                                        address: formData.get('address') || null,
                                        city: formData.get('city') || null,
                                        zip_code: zipCode || null,
                                        province: province || null,
                                        
                                };
                                
                                try {
                                        // Update user metadata in Supabase Auth
                                        const { error: authError } = await supabaseClient.auth.updateUser({
                                                data: updateData
                                        });
                                        
                                        if (authError) throw authError;
                                        
                                        // Also try to update profiles table if it exists
                                        try {
                                                const profileUpdateData = {
                                                        first_name: updateData.first_name,
                                                        last_name: updateData.last_name,
                                                        date_of_birth: updateData.date_of_birth,
                                                        place_of_birth: updateData.place_of_birth,
                                                        gender: updateData.gender,
                                                        fiscal_code: updateData.fiscal_code,
                                                        phone: updateData.phone_number,
                                                        address: updateData.address,
                                                        city: updateData.city,
                                                        zip_code: updateData.zip_code,
                                                        province: updateData.province,
                                                        updated_at: new Date().toISOString()
                                                };
                                                
                                                const { error: profileError } = await supabaseClient
                                                        .from('profiles')
                                                        .update(profileUpdateData)
                                                        .eq('id', currentUser.id);
                                                        
                                                if (profileError) {
                                                        console.warn('Profile table update failed:', profileError);
                                                        // Don't throw error - auth update succeeded
                                                }
                                        } catch (profileError) {
                                                console.warn('Profiles table not accessible:', profileError);
                                                // Continue - auth metadata update succeeded
                                        }
                                        
                                        notify.success('Profilo aggiornato con successo!');
                                        hideEditProfile();
                                        // Refresh user info
                                        checkAuthentication();
                                        
                                } catch (error) {
                                        console.error('Profile update error:', error);
                                        notify.error('Errore durante l\'aggiornamento del profilo: ' + error.message);
                                } finally {
                                        // Reset button state
                                        submitBtn.disabled = false;
                                        submitBtn.innerHTML = originalText;
                                }
                        }
                        
                        async function handlePasswordChange(event) {
                                event.preventDefault();
                                
                                const submitBtn = event.target.querySelector('button[type="submit"]');
                                const originalText = submitBtn.innerHTML;
                                
                                const formData = new FormData(event.target);
                                const currentPassword = formData.get('currentPassword');
                                const newPassword = formData.get('newPassword');
                                const confirmPassword = formData.get('confirmPassword');
                                
                                // Validate passwords match
                                if (newPassword !== confirmPassword) {
                                        notify.error('Le password non coincidono');
                                        return;
                                }
                                
                                // Validate password length
                                if (newPassword.length < 6) {
                                        notify.error('La password deve essere lunga almeno 6 caratteri');
                                        return;
                                }
                                
                                // Show loading state
                                submitBtn.disabled = true;
                                submitBtn.innerHTML = '? Cambiando...';
                                
                                try {
                                        const { error } = await supabaseClient.auth.updateUser({
                                                password: newPassword
                                        });
                                        
                                        if (error) throw error;
                                        
                                        notify.success('Password cambiata con successo!');
                                        hideChangePassword();
                                        
                                        // Clear form
                                        document.getElementById('update-password-form').reset();
                                        
                                } catch (error) {
                                        console.error('Password change error:', error);
                                        notify.error('Errore durante il cambio password: ' + error.message);
                                } finally {
                                        // Reset button state
                                        submitBtn.disabled = false;
                                        submitBtn.innerHTML = originalText;
                                }
                        }

                        // Event Listeners
                        document.addEventListener('DOMContentLoaded', function() {
                                // Add logout button event listener
                                if (logoutBtn) {
                                        logoutBtn.addEventListener('click', handleLogout);
                                }
                                
                                // Profile management buttons
                                const editProfileBtn = document.getElementById('edit-profile-btn');
                                const changePasswordBtn = document.getElementById('change-password-btn');
                                const cancelEditBtn = document.getElementById('cancel-edit-btn');
                                const cancelPasswordBtn = document.getElementById('cancel-password-btn');
                                const updateProfileForm = document.getElementById('update-profile-form');
                                const updatePasswordForm = document.getElementById('update-password-form');
                                
                                if (editProfileBtn) {
                                        editProfileBtn.addEventListener('click', showEditProfile);
                                }
                                if (changePasswordBtn) {
                                        changePasswordBtn.addEventListener('click', showChangePassword);
                                }
                                const changeEmailBtn = document.getElementById('change-email-btn');
                                if (changeEmailBtn) {
                                        changeEmailBtn.addEventListener('click', showChangeEmail);
                                }
                                if (cancelEditBtn) {
                                        cancelEditBtn.addEventListener('click', hideEditProfile);
                                }
                                if (cancelPasswordBtn) {
                                        cancelPasswordBtn.addEventListener('click', hideChangePassword);
                                }
                                if (updateProfileForm) {
                                        updateProfileForm.addEventListener('submit', handleProfileUpdate);
                                }
                                if (updatePasswordForm) {
                                        updatePasswordForm.addEventListener('submit', handlePasswordChange);
                                }
                                
                                // Check authentication on page load
                                checkAuthentication();
                                
                                // Events management initialization
                                initializeEventsManagement();
                        });
                        
                        // Events Management Functions
                        let allUsers = [];
                        let currentEditingEventId = null;
                        
                        async function initializeEventsManagement() {
                                // Load users for the dropdown
                                await loadUsers();
                                
                                // Setup event listeners for events management
                                setupEventsEventListeners();
                                
                                // Load events list
                                await loadEventsList();
                                
                                // Initialize users management
                                await initializeUsersManagement();
                        }
                        
                        async function loadUsers() {
                                try {
                                        // Try to load from profiles table first
                                        let { data: profiles, error: profilesError } = await supabaseClient
                                                .from('profiles')
                                                .select('id, first_name, last_name, email');
                                        
                                        if (profilesError) {
                                                console.warn('Cannot access profiles table:', profilesError);
                                                // Fallback: use auth metadata if available
                                                allUsers = [];
                                                return;
                                        }
                                        
                                        allUsers = profiles || [];
                                        populateUsersDropdown();
                                        
                                } catch (error) {
                                        console.error('Error loading users:', error);
                                        allUsers = [];
                                }
                        }
                        
                        function populateUsersDropdown() {
                                const dropdown = document.getElementById('event-created-by');
                                if (!dropdown) return;
                                
                                // Clear existing options except the first one
                                while (dropdown.children.length > 1) {
                                        dropdown.removeChild(dropdown.lastChild);
                                }
                                
                                // Add current user as default
                                if (currentUser) {
                                        const currentUserOption = document.createElement('option');
                                        currentUserOption.value = currentUser.id;
                                        currentUserOption.textContent = getUserDisplayName(currentUser);
                                        currentUserOption.selected = true;
                                        dropdown.appendChild(currentUserOption);
                                }
                                
                                // Add other users
                                allUsers.forEach(user => {
                                        if (user.id !== currentUser?.id) {
                                                const option = document.createElement('option');
                                                option.value = user.id;
                                                option.textContent = getUserDisplayName(user);
                                                dropdown.appendChild(option);
                                        }
                                });
                        }
                        
                        function getUserDisplayName(user) {
                                if (user.first_name && user.last_name) {
                                        return `${user.first_name} ${user.last_name}`;
                                }
                                if (user.first_name) return user.first_name;
                                if (user.last_name) return user.last_name;
                                return user.email || 'Utente senza nome';
                        }
                        
                        function setupEventsEventListeners() {
                                // Tab switching
                                const showEventsListBtn = document.getElementById('show-events-list');
                                const showCreateEventBtn = document.getElementById('show-create-event');
                                
                                if (showEventsListBtn) {
                                        showEventsListBtn.addEventListener('click', () => switchToEventsTab('list'));
                                }
                                if (showCreateEventBtn) {
                                        showCreateEventBtn.addEventListener('click', () => switchToEventsTab('form'));
                                }
                                
                                // Form handling
                                const eventForm = document.getElementById('event-management-form');
                                const cancelFormBtn = document.getElementById('cancel-event-form');
                                const deleteEventBtn = document.getElementById('delete-event-btn');
                                
                                if (eventForm) {
                                        eventForm.addEventListener('submit', handleEventSubmit);
                                }
                                if (cancelFormBtn) {
                                        cancelFormBtn.addEventListener('click', cancelEventForm);
                                }
                                if (deleteEventBtn) {
                                        deleteEventBtn.addEventListener('click', handleEventDelete);
                                }
                        }
                        
                        function switchToEventsTab(tab) {
                                const listSection = document.getElementById('events-list-section');
                                const formSection = document.getElementById('event-form-section');
                                const listBtn = document.getElementById('show-events-list');
                                const formBtn = document.getElementById('show-create-event');
                                
                                if (tab === 'list') {
                                        listSection.style.display = 'block';
                                        formSection.style.display = 'none';
                                        listBtn.classList.add('active-tab');
                                        listBtn.classList.remove('btn-outline');
                                        listBtn.classList.add('btn-primary');
                                        formBtn.classList.remove('active-tab');
                                        formBtn.classList.add('btn-outline');
                                        formBtn.classList.remove('btn-primary');
                                } else {
                                        listSection.style.display = 'none';
                                        formSection.style.display = 'block';
                                        formBtn.classList.add('active-tab');
                                        formBtn.classList.remove('btn-outline');
                                        formBtn.classList.add('btn-primary');
                                        listBtn.classList.remove('active-tab');
                                        listBtn.classList.add('btn-outline');
                                        listBtn.classList.remove('btn-primary');
                                        
                                        // Reset form for new event
                                        if (!currentEditingEventId) {
                                                resetEventForm();
                                        }
                                }
                        }
                        
                        async function loadEventsList() {
                                try {
                                        const { data: events, error } = await supabaseClient
                                                .from('events')
                                                .select('*')
                                                .order('event_date', { ascending: false });
                                        
                                        if (error) throw error;
                                        
                                        renderEventsTable(events || []);
                                        
                                } catch (error) {
                                        console.error('Error loading events:', error);
                                        notify.error('Errore nel caricamento degli eventi: ' + error.message);
                                }
                        }
                        
                        function renderEventsTable(events) {
                                const tbody = document.getElementById('admin-events-tbody');
                                const noEventsMessage = document.getElementById('no-events-message');
                                
                                if (!tbody) {
                                        console.error('Table tbody not found!');
                                        return;
                                }
                                
                                if (events.length === 0) {
                                        tbody.innerHTML = '';
                                        if (noEventsMessage) noEventsMessage.style.display = 'block';
                                        return;
                                }
                                
                                if (noEventsMessage) noEventsMessage.style.display = 'none';
                                
                                tbody.innerHTML = events.map(event => `
                                        <tr style="border-bottom: 1px solid #ddd;">
                                                <td class="event-title" style="padding: 12px; border: 1px solid #ddd; font-weight: 600; color: #e10600; word-wrap: break-word; max-width: 250px;">${escapeHtml(event.title || '')}</td>
                                                <td class="event-date" style="padding: 12px; border: 1px solid #ddd; white-space: nowrap; text-align: center; color: #333; font-weight: 500;">${formatDate(event.event_date)}</td>
                                                <td style="padding: 12px; border: 1px solid #ddd; word-wrap: break-word; max-width: 200px; text-align: center;">${escapeHtml(event.location || '-')}</td>
                                                <td class="event-public" style="padding: 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">${event.is_public ? '? S�' : '? No'}</td>
                                                <td class="event-actions" style="padding: 8px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">
                                                        <button onclick="editEvent('${event.id}')" class="btn-sm btn-edit" style="padding: 6px 12px; margin-right: 8px; margin-bottom: 0; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; display: inline-block; text-decoration: none; outline: none;">?? Modifica</button>
                                                        <button onclick="deleteEvent('${event.id}')" class="btn-sm btn-delete" style="padding: 6px 12px; margin-bottom: 0; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; display: inline-block; text-decoration: none; outline: none;">??? Elimina</button>
                                                </td>
                                        </tr>
                                `).join('');
                        }
                        
                        function formatDate(dateString) {
                                if (!dateString || dateString === null || dateString === undefined) {
                                        return '-';
                                }
                                try {
                                        // Gestione formato ISO (YYYY-MM-DD)
                                        if (/^\d{4}-\d{2}-\d{2}$/.test(dateString)) {
                                                const [year, month, day] = dateString.split('-');
                                                return `${day}/${month}/${year}`;
                                        }
                                        // Gestione formato con orario (YYYY-MM-DDTHH:mm:ss)
                                        if (/^\d{4}-\d{2}-\d{2}T/.test(dateString)) {
                                                const date = new Date(dateString);
                                                if (!isNaN(date.getTime())) {
                                                        return date.toLocaleDateString('it-IT');
                                                }
                                        }
                                        // Fallback generico
                                        const date = new Date(dateString);
                                        if (!isNaN(date.getTime())) {
                                                return date.toLocaleDateString('it-IT');
                                        }
                                        return dateString;
                                } catch (error) {
                                        return dateString || '-';
                                }
                        }
                        
                        function getStatusLabel(status) {
                                return '';
                        }
                        
                        function escapeHtml(text) {
                                const div = document.createElement('div');
                                div.textContent = text;
                                return div.innerHTML;
                        }
                        
                        function resetEventForm() {
                                const form = document.getElementById('event-management-form');
                                const title = document.getElementById('event-form-title');
                                const deleteBtn = document.getElementById('delete-event-btn');
                                
                                if (form) form.reset();
                                if (title) title.textContent = '? Nuovo Evento';
                                if (deleteBtn) deleteBtn.style.display = 'none';
                                
                                currentEditingEventId = null;
                                
                                // Set default values
                                const isPublicCheckbox = document.getElementById('event-is-public');
                                const createdBySelect = document.getElementById('event-created-by');
                                
                                if (isPublicCheckbox) isPublicCheckbox.checked = true;
                                if (createdBySelect && currentUser) createdBySelect.value = currentUser.id;
                        }
                        
                        function cancelEventForm() {
                                resetEventForm();
                                switchToEventsTab('list');
                        }
                        
                        async function handleEventSubmit(event) {
                                event.preventDefault();
                                
                                const submitBtn = document.getElementById('save-event-btn');
                                const originalText = submitBtn.innerHTML;
                                
                                // Show loading state
                                submitBtn.disabled = true;
                                submitBtn.innerHTML = '? Salvando...';
                                
                                try {
                                        const formData = new FormData(event.target);
                                        
                                        // Validation
                                        if (!formData.get('title')?.trim()) {
                                                throw new Error('Il titolo � obbligatorio');
                                        }
                                        if (!formData.get('event_date')) {
                                                throw new Error('La data � obbligatoria');
                                        }
                                        
                                        const eventData = {
                                                title: formData.get('title').trim(),
                                                description: formData.get('description')?.trim() || null,
                                                content: formData.get('content')?.trim() || null,
                                                event_date: formData.get('event_date'),
                                                event_time: formData.get('event_time')?.trim() || null,
                                                location: formData.get('location')?.trim() || null,
                                                address: formData.get('address')?.trim() || null,
                                                image_url: formData.get('image_url')?.trim() || null,
                                                created_by: formData.get('created_by') || currentUser?.id,
                                                is_public: formData.get('is_public') === 'on',
                                                updated_at: new Date().toISOString()
                                        };
                                        
                                        let result;
                                        if (currentEditingEventId) {
                                                // Update existing event
                                                result = await supabaseClient
                                                        .from('events')
                                                        .update(eventData)
                                                        .eq('id', currentEditingEventId);
                                        } else {
                                                // Create new event
                                                eventData.created_at = new Date().toISOString();
                                                result = await supabaseClient
                                                        .from('events')
                                                        .insert([eventData]);
                                        }
                                        
                                        if (result.error) throw result.error;
                                        
                                        notify.success(currentEditingEventId ? 'Evento aggiornato con successo!' : 'Evento creato con successo!');
                                        
                                        // Refresh events list and switch to list view
                                        await loadEventsList();
                                        switchToEventsTab('list');
                                        
                                } catch (error) {
                                        console.error('Error saving event:', error);
                                        notify.error('Errore nel salvataggio: ' + error.message);
                                } finally {
                                        // Reset button state
                                        submitBtn.disabled = false;
                                        submitBtn.innerHTML = originalText;
                                }
                        }
                        
                        async function editEvent(eventId) {
                                try {
                                        const { data: event, error } = await supabaseClient
                                                .from('events')
                                                .select('*')
                                                .eq('id', eventId)
                                                .single();
                                        
                                        if (error) throw error;
                                        
                                        // Populate form with event data
                                        currentEditingEventId = eventId;
                                        populateEventForm(event);
                                        
                                        // Switch to form view
                                        switchToEventsTab('form');
                                        
                                        // Update form title and show delete button
                                        const title = document.getElementById('event-form-title');
                                        const deleteBtn = document.getElementById('delete-event-btn');
                                        
                                        if (title) title.textContent = '?? Modifica Evento';
                                        if (deleteBtn) deleteBtn.style.display = 'inline-block';
                                        
                                } catch (error) {
                                        console.error('Error loading event for edit:', error);
                                        notify.error('Errore nel caricamento dell\'evento: ' + error.message);
                                }
                        }
                        
                        function populateEventForm(event) {
                                document.getElementById('event-id').value = event.id || '';
                                document.getElementById('event-title').value = event.title || '';
                                document.getElementById('event-description').value = event.description || '';
                                document.getElementById('event-content').value = event.content || '';
                                document.getElementById('event-date').value = event.event_date || '';
                                document.getElementById('event-time').value = event.event_time || '';
                                document.getElementById('event-location').value = event.location || '';
                                document.getElementById('event-address').value = event.address || '';
                                document.getElementById('event-image-url').value = event.image_url || '';
                                document.getElementById('event-created-by').value = event.created_by || '';
                                document.getElementById('event-is-public').checked = event.is_public !== false;
                        }
                        
                        async function deleteEvent(eventId) {
                                if (!confirm('Sei sicuro di voler eliminare questo evento? Questa azione non pu� essere annullata.')) {
                                        return;
                                }
                                
                                try {
                                        const { error } = await supabaseClient
                                                .from('events')
                                                .delete()
                                                .eq('id', eventId);
                                        
                                        if (error) throw error;
                                        
                                        notify.success('Evento eliminato con successo!');
                                        await loadEventsList();
                                        
                                        // If we were editing this event, switch back to list
                                        if (currentEditingEventId === eventId) {
                                                switchToEventsTab('list');
                                        }
                                        
                                } catch (error) {
                                        console.error('Error deleting event:', error);
                                        notify.error('Errore nell\'eliminazione: ' + error.message);
                                }
                        }
                        
                        async function handleEventDelete() {
                                if (currentEditingEventId) {
                                        await deleteEvent(currentEditingEventId);
                                }
                        }
                        
                        // Make functions globally available for onclick handlers
                        window.editEvent = editEvent;
                        window.deleteEvent = deleteEvent;
                        
                        // Users Management Functions
                        async function loadUsersList() {
                                try {
                                        // Load users from profiles table
                                        const { data: profiles, error: profilesError } = await supabaseClient
                                                .from('profiles')
                                                .select('*')
                                                .order('created_at', { ascending: false });

                                        if (profilesError) {
                                                console.error('Error loading profiles:', profilesError);
                                                throw profilesError;
                                        }

                                        console.log('Loaded profiles:', profiles);
                                        displayUsersList(profiles || []);
                                        
                                } catch (error) {
                                        console.error('Error loading users:', error);
                                        document.getElementById('users-table').innerHTML = 
                                                '<p style="text-align: center; padding: 20px; color: #e74c3c;">Errore nel caricamento degli utenti: ' + error.message + '</p>';
                                }
                        }

                        function displayUsersList(users) {
                                const usersTable = document.getElementById('users-table');
                                
                                if (!users || users.length === 0) {
                                        usersTable.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">Nessun utente trovato.</p>';
                                        return;
                                }

                                let tableHTML = `
                                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                                <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                                        <tr>
                                                                <th style="padding: 15px; text-align: left; font-weight: 600;">Nome</th>
                                                                <th style="padding: 15px; text-align: left; font-weight: 600;">Email</th>
                                                                <th style="padding: 15px; text-align: center; font-weight: 600;">Telefono</th>
                                                                <th style="padding: 15px; text-align: center; font-weight: 600;">Ruolo</th>
                                                                <th style="padding: 15px; text-align: center; font-weight: 600;">Tipo Socio</th>
                                                                <th style="padding: 15px; text-align: center; font-weight: 600;">Registrato</th>
                                                                <th style="padding: 15px; text-align: center; font-weight: 600;">Azioni</th>
                                                        </tr>
                                                </thead>
                                                <tbody>
                                `;

                                users.forEach((user, index) => {
                                        const fullName = user.full_name || 
                                                        (user.first_name && user.last_name ? 
                                                         `${user.first_name} ${user.last_name}` : 
                                                         user.first_name || user.last_name || 'Nome non disponibile');
                                        
                                        const email = user.email || 'Email non disponibile';
                                        const phone = user.phone_number || '-';
                                        const role = user.role || 'utente';
                                        const membershipType = user.membership_type1 || user.membership_type2 || '-';
                                        const membershipStatus = user.membership_status || 'attivo';
                                        // Capitalize first letter for display
                                        const membershipStatusDisplay = membershipStatus.charAt(0).toUpperCase() + membershipStatus.slice(1);
                                        const privacyAccepted = user.privacy_accepted ? '?' : '?';
                                        const createdAt = user.created_at ? new Date(user.created_at).toLocaleDateString('it-IT') : 'N/D';
                                        const userId = user.id; // Use only id field
                                        console.log(`User ${index}: ID=${user.id}, using=${userId}`);
                                        
                                        const rowStyle = index % 2 === 0 ? 'background-color: #f8f9fa;' : 'background-color: white;';
                                        
                                        tableHTML += `
                                                <tr style="${rowStyle}">
                                                        <td style="padding: 12px; border: 1px solid #ddd;">
                                                                <strong>${escapeHtml(fullName)}</strong>
                                                                ${user.date_of_birth ? `<br><small style="color: #666;">Nato il: ${new Date(user.date_of_birth).toLocaleDateString('it-IT')}</small>` : ''}
                                                        </td>
                                                        <td style="padding: 12px; border: 1px solid #ddd;">
                                                                ${escapeHtml(email)}
                                                                ${user.city ? `<br><small style="color: #666;">${escapeHtml(user.city)}</small>` : ''}
                                                        </td>
                                                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">
                                                                ${escapeHtml(phone)}
                                                        </td>
                                                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">
                                                                <select onchange="updateUserRole('${userId}', this.value)" 
                                                                        style="padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; background: white;">
                                                                        <option value="utente" ${role === 'utente' ? 'selected' : ''}>Utente</option>
                                                                        <option value="socio" ${role === 'socio' ? 'selected' : ''}>Socio</option>
                                                                        <option value="admin" ${role === 'admin' ? 'selected' : ''}>Admin</option>
                                                                </select>
                                                        </td>
                                                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">
                                                                ${escapeHtml(membershipType)}
                                                        </td>
                                                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">
                                                                ${createdAt}
                                                        </td>
                                                        <td class="user-actions" style="padding: 8px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">
                                                                <button onclick="editUserProfile('${userId}')" 
                                                                        class="btn-sm btn-edit" 
                                                                        style="padding: 4px 8px; margin-right: 4px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; text-decoration: none; outline: none;">
                                                                        ?? Modifica
                                                                </button>
                                                                <button onclick="deleteUser('${userId}')" 
                                                                        class="btn-sm btn-delete" 
                                                                        style="padding: 4px 8px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; text-decoration: none; outline: none;">
                                                                        ??? Elimina
                                                                </button>
                                                        </td>
                                                </tr>
                                        `;
                                });

                                tableHTML += `
                                                </tbody>
                                        </table>
                                `;

                                usersTable.innerHTML = tableHTML;
                        }

                        async function updateUserRole(userId, newRole) {
                                try {
                                        // Update role in profiles table
                                        const { error } = await supabaseClient
                                                .from('profiles')
                                                .update({ role: newRole, updated_at: new Date().toISOString() })
                                                .eq('id', userId);

                                        if (error) throw error;

                                        notify.success(`Ruolo aggiornato a: ${newRole}`);
                                        
                                } catch (error) {
                                        console.error('Error updating user role:', error);
                                        notify.error('Errore nell\'aggiornamento del ruolo: ' + error.message);
                                        // Reload the users list to reset the dropdown
                                        await loadUsersList();
                                }
                        }

                        async function resendConfirmationToUser(userId) {
                                try {
                                        const { error } = await supabaseClient.auth.admin.generateLink({
                                                type: 'signup',
                                                email: userId // This would need the actual email
                                        });

                                        if (error) throw error;

                                        notify.success('Email di conferma inviata!');
                                        
                                } catch (error) {
                                        console.error('Error resending confirmation:', error);
                                        notify.error('Errore nell\'invio della conferma: ' + error.message);
                                }
                        }

                        async function deleteUser(userId) {
                                if (!confirm('Sei sicuro di voler eliminare questo profilo utente? Questa azione non pu� essere annullata.')) {
                                        return;
                                }

                                try {
                                        // Delete user profile from profiles table
                                        const { error } = await supabaseClient
                                                .from('profiles')
                                                .delete()
                                                .eq('id', userId);

                                        if (error) throw error;

                                        notify.success('Profilo utente eliminato con successo!');
                                        await loadUsersList();
                                        
                                } catch (error) {
                                        console.error('Error deleting user profile:', error);
                                        notify.error('Errore nell\'eliminazione del profilo: ' + error.message);
                                }
                        }

                        // Initialize users management when authentication is complete
                        async function initializeUsersManagement() {
                                // Load users list when the tab is shown
                                const showUsersBtn = document.getElementById('show-users-list');
                                if (showUsersBtn) {
                                        showUsersBtn.addEventListener('click', () => {
                                                loadUsersList();
                                        });
                                }

                                // Load users list initially if user has admin privileges
                                if (userRole === 'admin' || userRole === 'socio') {
                                        await loadUsersList();
                                }
                        }

                        // Function to edit user profile
                        async function editUserProfile(userId) {
                                try {
                                        console.log('Loading profile for ID:', userId);
                                        
                                        // Get user data using id field only
                                        let { data: profile, error } = await supabaseClient
                                                .from('profiles')
                                                .select('*')
                                                .eq('id', userId)
                                                .single();

                                        if (error) throw error;
                                        
                                        console.log('Loaded profile:', profile);

                                        // Create a modal or form for editing
                                        const modalHTML = `
                                                <div id="edit-user-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                                                        <div style="background: white; padding: 30px; border-radius: 10px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                                                                <h3 style="margin-top: 0; color: #333;">Modifica Profilo Utente</h3>
                                                                <form id="edit-user-form">
                                                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nome *</label>
                                                                                        <input type="text" id="edit-user-first-name" value="${profile.first_name || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" required>
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Cognome *</label>
                                                                                        <input type="text" id="edit-user-last-name" value="${profile.last_name || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" required>
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Email *</label>
                                                                                        <input type="email" id="edit-user-email" value="${profile.email || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" required>
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Telefono</label>
                                                                                        <input type="tel" id="edit-user-phone" value="${profile.phone_number || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Data di Nascita</label>
                                                                                        <input type="date" id="edit-user-birth-date" value="${profile.date_of_birth || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Luogo di Nascita</label>
                                                                                        <input type="text" id="edit-user-birth-place" value="${profile.place_of_birth || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Sesso</label>
                                                                                        <select id="edit-user-gender" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                                                                <option value="">Seleziona...</option>
                                                                                                <option value="M" ${profile.gender === 'M' ? 'selected' : ''}>Maschio</option>
                                                                                                <option value="F" ${profile.gender === 'F' ? 'selected' : ''}>Femmina</option>
                                                                                        </select>
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Codice Fiscale</label>
                                                                                        <input type="text" id="edit-user-fiscal-code" value="${profile.fiscal_code || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; text-transform: uppercase;" maxlength="16">
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Indirizzo</label>
                                                                                        <input type="text" id="edit-user-address" value="${profile.address || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Citt�</label>
                                                                                        <input type="text" id="edit-user-city" value="${profile.city || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">CAP</label>
                                                                                        <input type="text" id="edit-user-zip" value="${profile.zip_code || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" pattern="[0-9]{5}" maxlength="5">
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Provincia</label>
                                                                                        <input type="text" id="edit-user-province" value="${profile.province || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; text-transform: uppercase;" maxlength="2">
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ruolo</label>
                                                                                        <select id="edit-user-role" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                                                                <option value="utente" ${profile.role === 'utente' ? 'selected' : ''}>Utente</option>
                                                                                                <option value="socio" ${profile.role === 'socio' ? 'selected' : ''}>Socio</option>
                                                                                                <option value="admin" ${profile.role === 'admin' ? 'selected' : ''}>Admin</option>
                                                                                        </select>
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo Socio 1</label>
                                                                                        <input type="text" id="edit-user-membership1" value="${profile.membership_type1 || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo Socio 2</label>
                                                                                        <input type="text" id="edit-user-membership2" value="${profile.membership_type2 || ''}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                                                </div>
                                                                                <div>
                                                                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Stato Iscrizione</label>
                                                                                        <select id="edit-user-status" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                                                                                <option value="attivo" ${(profile.membership_status || '').toLowerCase() === 'attivo' ? 'selected' : ''}>Attivo</option>
                                                                                                <option value="sospeso" ${(profile.membership_status || '').toLowerCase() === 'sospeso' ? 'selected' : ''}>Sospeso</option>
                                                                                                <option value="scaduto" ${(profile.membership_status || '').toLowerCase() === 'scaduto' ? 'selected' : ''}>Scaduto</option>
                                                                                                <option value="cancellato" ${(profile.membership_status || '').toLowerCase() === 'cancellato' ? 'selected' : ''}>Cancellato</option>
                                                                                        </select>
                                                                                </div>
                                                                                <div style="grid-column: span 2;">
                                                                                        <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                                                                                                <input type="checkbox" id="edit-user-privacy" ${profile.privacy_accepted ? 'checked' : ''}>
                                                                                                <span style="font-weight: bold;">Privacy Accettata</span>
                                                                                        </label>
                                                                                </div>
                                                                        </div>
                                                                        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                                                                                <button type="button" onclick="closeEditUserModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Annulla</button>
                                                                                <button type="submit" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">?? Salva Modifiche</button>
                                                                        </div>
                                                                </form>
                                                        </div>
                                                </div>
                                        `;

                                        document.body.insertAdjacentHTML('beforeend', modalHTML);

                                        // Add form submit handler
                                        document.getElementById('edit-user-form').addEventListener('submit', async (e) => {
                                                e.preventDefault();
                                                await saveUserProfile(userId);
                                        });

                                } catch (error) {
                                        console.error('Error loading user profile:', error);
                                        notify.error('Errore nel caricamento del profilo: ' + error.message);
                                }
                        }

                        async function saveUserProfile(userId) {
                                try {
                                        console.log('Updating user profile for ID:', userId);
                                        
                        const updateData = {
                                first_name: document.getElementById('edit-user-first-name').value,
                                last_name: document.getElementById('edit-user-last-name').value,
                                email: document.getElementById('edit-user-email').value,
                                phone_number: document.getElementById('edit-user-phone').value || null,
                                date_of_birth: document.getElementById('edit-user-birth-date').value || null,
                                place_of_birth: document.getElementById('edit-user-birth-place').value,
                                gender: document.getElementById('edit-user-gender').value,
                                fiscal_code: document.getElementById('edit-user-fiscal-code').value.toUpperCase(),
                                address: document.getElementById('edit-user-address').value,
                                city: document.getElementById('edit-user-city').value,
                                zip_code: document.getElementById('edit-user-zip').value,
                                province: document.getElementById('edit-user-province').value.toUpperCase(),
                                role: document.getElementById('edit-user-role').value,
                                membership_type1: document.getElementById('edit-user-membership1').value,
                                membership_type2: document.getElementById('edit-user-membership2').value,
                                membership_status: document.getElementById('edit-user-status').value, // Values are already lowercase
                                privacy_accepted: document.getElementById('edit-user-privacy').checked
                        };                                        // Remove empty values and fields that don't exist in the table
                                        Object.keys(updateData).forEach(key => {
                                                if (updateData[key] === '' || updateData[key] === null) {
                                                        if (key !== 'date_of_birth') { // Keep null for date_of_birth if empty
                                                                updateData[key] = null;
                                                        }
                                                }
                                        });

                                        console.log('Update data:', updateData);
                                        console.log('Current user session:', supabaseClient.auth.getSession());

                                        // First verify the user exists and get current data
                                        const { data: existingUser, error: checkError } = await supabaseClient
                                                .from('profiles')
                                                .select('*')
                                                .eq('id', userId)
                                                .single();

                                        if (checkError || !existingUser) {
                                                console.error('User not found:', checkError);
                                                throw new Error('Utente non trovato nella tabella profiles');
                                        }

                                        console.log('Current user data:', existingUser);
                                        console.log('User exists, proceeding with update...');

                                        // Try update with explicit returning all fields
                                        const { data, error, status, statusText } = await supabaseClient
                                                .from('profiles')
                                                .update(updateData)
                                                .eq('id', userId)
                                                .select('*');

                                        console.log('Update result data:', data);
                                        console.log('Update result error:', error);
                                        console.log('Update result status:', status);
                                        console.log('Update result statusText:', statusText);

                                        if (error) {
                                                console.error('Update error details:', error);
                                                throw error;
                                        }

                                        // If no data returned but no error, try alternative approaches
                                        if (!data || data.length === 0) {
                                                console.log('No data returned from update, trying alternative approaches...');
                                                
                                                // Try using upsert instead
                                                console.log('Attempting upsert...');

                                                let upsertData = { ...updateData, id: userId };
                                                const { data: upsertResult, error: upsertError } = await supabaseClient
                                                        .from('profiles')
                                                        .upsert(upsertData, { onConflict: 'id' })
                                                        .select('*');

                                                console.log('Upsert result:', upsertResult);
                                                console.log('Upsert error:', upsertError);
                                                // Logga warning se membership_type2 non coincide
                                                if (upsertResult && upsertResult.length > 0 && upsertData.membership_type2) {
                                                    const dbType2 = upsertResult[0].membership_type2;
                                                    if (dbType2 && dbType2 !== upsertData.membership_type2) {
                                                        console.warn(`ATTENZIONE: membership_type2 inviato='${upsertData.membership_type2}', restituito dal DB='${dbType2}'. Probabile normalizzazione lato database.`);
                                                    }
                                                }

                                                if (upsertError) {
                                                        console.error('Upsert failed, trying direct query approach...');
                                                        
                                                        // Last resort: verify if data actually changed
                                                        const { data: verifyData, error: verifyError } = await supabaseClient
                                                                .from('profiles')
                                                                .select('*')
                                                                .eq('id', userId)
                                                                .single();

                                                        if (verifyError) {
                                                                throw new Error('Errore nella verifica dell\'aggiornamento: ' + verifyError.message);
                                                        }

                                                        console.log('Comparing data...');
                                                        console.log('Original data:', existingUser);
                                                        console.log('Current data:', verifyData);
                                                        console.log('Expected updates:', updateData);

                                                        // Check if data actually changed
                                                        let hasChanges = false;
                                                        let failedUpdates = [];
                                                        
                                                        for (const [key, value] of Object.entries(updateData)) {
                                                                // Skip comparison for fields that might not exist in existingUser
                                                                if (!(key in existingUser)) {
                                                                        console.log(`Field ${key} not in original data, skipping comparison`);
                                                                        continue;
                                                                }
                                                                
                                                                let originalValue = existingUser[key];
                                                                let currentValue = verifyData[key];
                                                                let expectedValue = value;
                                                                
                                                                // Handle case sensitivity for string comparisons
                                                                if (typeof originalValue === 'string' && typeof expectedValue === 'string') {
                                                                        originalValue = originalValue.toLowerCase();
                                                                        currentValue = currentValue ? currentValue.toLowerCase() : currentValue;
                                                                        expectedValue = expectedValue.toLowerCase();
                                                                }
                                                                
                                                                if (originalValue !== expectedValue) {
                                                                        hasChanges = true;
                                                                        if (currentValue === expectedValue || (expectedValue === null && currentValue === null)) {
                                                                                console.log(`Field ${key} was updated successfully: ${existingUser[key]} -> ${verifyData[key]}`);
                                                                        } else {
                                                                                console.log(`Field ${key} was NOT updated: expected ${value}, got ${verifyData[key]}`);
                                                                                failedUpdates.push(key);
                                                                        }
                                                                }
                                                        }

                                                        if (failedUpdates.length > 0) {
                                                                throw new Error(`Campi non aggiornati: ${failedUpdates.join(', ')}. Possibile problema di permessi RLS.`);
                                                        }

                                                        if (!hasChanges) {
                                                                console.log('No changes were needed - data was already up to date');
                                                        }
                                                } else if (upsertResult && upsertResult.length > 0) {
                                                        console.log('Upsert successful');
                                                } else {
                                                        throw new Error('Nessun metodo di aggiornamento ha funzionato. Controlla i permessi RLS.');
                                                }
                                        } else {
                                                console.log('Update successful with returned data:', data);
                                        }

                                        notify.success('Profilo aggiornato con successo!');
                                        closeEditUserModal();
                                        await loadUsersList();

                                } catch (error) {
                                        console.error('Error updating user profile:', error);
                                        notify.error('Errore nell\'aggiornamento: ' + error.message);
                                }
                        }

                        function closeEditUserModal() {
                                const modal = document.getElementById('edit-user-modal');
                                if (modal) {
                                        modal.remove();
                                }
                        }

                        // Global functions for buttons
                        window.resendConfirmation = resendConfirmation;
                        window.handleLogout = handleLogout;
                        window.updateUserRole = updateUserRole;
                        window.resendConfirmationToUser = resendConfirmationToUser;
                        window.deleteUser = deleteUser;
                        window.editUserProfile = editUserProfile;
                        window.closeEditUserModal = closeEditUserModal;
  </script> 
  <script src="assets/js/adblock-detector-v2.js"></script> 
  <script src="assets/js/adblock-integration-v2.js"></script>
</body>
</html>

