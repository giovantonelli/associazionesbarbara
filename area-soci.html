<!DOCTYPE html>
<html lang="it">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Area Soci - Associazione Santa Barbara APS</title>
		<meta name="description" content="Accesso riservato ai soci dell'Associazione Santa Barbara APS">
		<meta name="keywords" content="area soci, login, accesso riservato, associazione">
		<link rel="stylesheet" href="assets/css/style.css">
		<link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
		<!-- Google tag (gtag.js) with Consent Mode -->
		<script>
			// Define dataLayer and the gtag function
			window.dataLayer = window.dataLayer || [];

			function gtag() {
				dataLayer.push(arguments);
			}
			// Set default consent to 'denied' as a placeholder for EU users
			gtag('consent', 'default', {
				'ad_storage': 'denied',
				'ad_user_data': 'denied',
				'ad_personalization': 'denied',
				'analytics_storage': 'denied',
				'wait_for_update': 500
			});
		</script>
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-F465WJF33T"></script>
		<script>
			window.dataLayer = window.dataLayer || [];

			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());
			gtag('config', 'G-F465WJF33T');
		</script>
	</head>
	<body>
		<!-- Navigation -->
		<nav class="navbar">
			<div class="container">
				<div class="nav-brand">
					<img src="assets/images/logo.svg" alt="Logo Associazione Santa Barbara APS" class="logo">
					<span class="brand-text">Associazione Santa Barbara APS</span>
				</div>
				<button class="nav-toggle" aria-label="Toggle navigation">
					<span></span>
					<span></span>
					<span></span>
				</button>
				<ul class="nav-menu">
					<li>
						<a href="index.html" class="nav-link">Home</a>
					</li>
					<li>
						<a href="chi-siamo.html" class="nav-link">Chi siamo</a>
					</li>
					<li>
						<a href="attivita.html" class="nav-link">Attivit√†</a>
					</li>
					<li>
						<a href="eventi.html" class="nav-link">Eventi</a>
					</li>
					<li>
						<a href="galleria.html" class="nav-link">Galleria</a>
					</li>
					<li>
						<a href="faq.html" class="nav-link">FAQ</a>
					</li>
					<li>
						<a href="contatti.html" class="nav-link">Contatti</a>
					</li>
					<li>
						<a href="partner.html" class="nav-link">Partner</a>
					</li>
					<li>
						<a id="logout-btn" class="btn btn-secondary">üö™ Logout</a>
					</li>
				</ul>
			</div>
		</nav>
		<!-- Page Header -->
		<section class="page-header">
			<div class="container">
				<h1>Area Soci</h1>
				<p>Accesso riservato ai soci dell'associazione</p>
			</div>
		</section>
		<!-- Loading screen base -->
		<div id="loading-screen" class="loading-screen">
			<div class="loading-content">
				<div class="loading-spinner"></div>
				<h3>Caricamento in corso <span class="loading-dots"></span>
				</h3>
				<p>Attendere prego</p>
			</div>
		</div>
		<!-- Login Prompt Section -->
		<div id="login-prompt" style="display: none; padding: 60px 0; text-align: center;">
			<div class="container">
				<!-- Content will be dynamically inserted by JavaScript -->
			</div>
		</div>
		<!-- Members Content (for authenticated soci) -->
		<section id="members-content" class="members-content">
			<div class="container">
				<!-- User Info Section -->
				<div id="user-info" class="user-info">
					<!-- User info will be populated by JavaScript -->
				</div>
				<!-- Gestione Profilo -->
				<div class="content-section">
					<h3>‚öôÔ∏è Gestione Profilo</h3>
					<p>Gestisci i tuoi dati e le preferenze dell'account</p>
					<div class="profile-management">
						<div class="profile-actions">
							<button class="btn btn-outline">‚úèÔ∏è Modifica Profilo</button>
							<button class="btn btn-outline">üîë Cambia Password</button>
							<button class="btn btn-outline">üìß Preferenze Email</button>
							<button class="btn btn-outline">üì± Notifiche</button>
						</div>
					</div>
				</div>
		</section>
		<!-- Cookie Banner -->
		<div id="cookieBanner" class="cookie-banner" style="display: none;">
			<div class="cookie-content">
				<p>Questo sito utilizza cookie per migliorare l'esperienza di navigazione. Continuando a navigare accetti l'uso dei cookie.</p>
				<div class="cookie-buttons">
					<button id="acceptCookies" class="btn btn-primary">Accetta</button>
					<button id="rejectCookies" class="btn btn-secondary">Rifiuta</button>
					<a href="privacy.html" class="btn btn-link">Privacy Policy</a>
				</div>
			</div>
		</div>
		<!-- Dashboard Section -->
		<div class="dashboard-section">
			<svg width="40" height="40" viewBox="0 0 24 24" fill="var(--primary-color)">
				<path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
			</svg>
		</div>
		<div class="col-md-3">
			<div class="dashboard-card">
				<div class="dashboard-icon">
					<svg width="40" height="40" viewBox="0 0 24 24" fill="var(--primary-color)">
						<path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
					</svg>
				</div>
				<h3>Eventi</h3>
				<p>Calendario completo eventi e prenotazioni</p>
				<a href="eventi.html" class="btn btn-outline">Vedi calendario</a>
			</div>
		</div>
		<div class="col-md-3">
			<div class="dashboard-card">
				<div class="dashboard-icon">
					<svg width="40" height="40" viewBox="0 0 24 24" fill="var(--primary-color)">
						<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
					</svg>
				</div>
				<h3>Tessera</h3>
				<p>Gestisci la tua tessera e rinnova l'iscrizione</p>
				<a href="#" class="btn btn-outline">Gestisci tessera</a>
			</div>
		</div>
		<div class="col-md-3">
			<div class="dashboard-card">
				<div class="dashboard-icon">
					<svg width="40" height="40" viewBox="0 0 24 24" fill="var(--primary-color)">
						<path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
					</svg>
				</div>
				<h3>Comunicazioni</h3>
				<p>Messaggi e comunicazioni dell'associazione</p>
				<a href="#" class="btn btn-outline">Leggi messaggi</a>
			</div>
		</div>
		</div>
		</div>
		<!-- Prossimi Eventi -->
		<div class="members-events">
			<h3>I tuoi prossimi eventi</h3>
			<div class="row">
				<div class="col-md-6">
					<div class="event-summary">
						<div class="event-date">
							<span class="date-day">20</span>
							<span class="date-month">LUG</span>
						</div>
						<div class="event-info">
							<h4>Assemblea Ordinaria</h4>
							<p>üìÖ 20 Luglio 2025, ore 20:00</p>
							<p>üìç Sede Associazione</p>
							<span class="event-status confirmed">Presenza confermata</span>
						</div>
					</div>
				</div>
				<div class="col-md-6">
					<div class="event-summary">
						<div class="event-date">
							<span class="date-day">05</span>
							<span class="date-month">AGO</span>
						</div>
						<div class="event-info">
							<h4>Cena Sociale</h4>
							<p>üìÖ 5 Agosto 2025, ore 19:30</p>
							<p>üìç Ristorante Il Borgo</p>
							<span class="event-status pending">In attesa di conferma</span>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Documenti Recenti -->
		<div class="members-documents">
			<h3>Documenti recenti</h3>
			<div class="documents-list">
				<div class="document-item">
					<div class="document-icon">
						<svg width="24" height="24" viewBox="0 0 24 24" fill="var(--primary-color)">
							<path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
						</svg>
					</div>
					<div class="document-info">
						<h4>Verbale Assemblea Giugno 2025</h4>
						<p>Pubblicato il 15 Giugno 2025</p>
					</div>
					<div class="document-actions">
						<a href="#" class="btn btn-sm btn-outline">Scarica PDF</a>
					</div>
				</div>
				<div class="document-item">
					<div class="document-icon">
						<svg width="24" height="24" viewBox="0 0 24 24" fill="var(--primary-color)">
							<path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
						</svg>
					</div>
					<div class="document-info">
						<h4>Bilancio 2024</h4>
						<p>Pubblicato il 30 Marzo 2025</p>
					</div>
					<div class="document-actions">
						<a href="#" class="btn btn-sm btn-outline">Scarica PDF</a>
					</div>
				</div>
				<div class="document-item">
					<div class="document-icon">
						<svg width="24" height="24" viewBox="0 0 24 24" fill="var(--primary-color)">
							<path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
						</svg>
					</div>
					<div class="document-info">
						<h4>Programma Attivit√† 2025</h4>
						<p>Pubblicato il 15 Gennaio 2025</p>
					</div>
					<div class="document-actions">
						<a href="#" class="btn btn-sm btn-outline">Scarica PDF</a>
					</div>
				</div>
			</div>
		</div>
		<!-- Profilo Socio -->
		<div class="member-profile">
			<h3>Il tuo profilo</h3>
			<div class="profile-info">
				<div class="row">
					<div class="col-md-6">
						<div class="profile-section">
							<h4>Informazioni personali</h4>
							<p>
								<strong>Nome:</strong> Mario Rossi
							</p>
							<p>
								<strong>Email:</strong> info@associazionesbarbara.it
							</p>
							<p>
								<strong>Telefono:</strong> +39 123 456 7890
							</p>
							<p>
								<strong>Tessera n¬∞:</strong> 2025-001
							</p>
						</div>
					</div>
					<div class="col-md-6">
						<div class="profile-section">
							<h4>Stato iscrizione</h4>
							<p>
								<strong>Tipo:</strong> Socio ordi
							<p>
								<strong>Iscritto dal:</strong> 15 Gennaio 2020
							</p>
							<p>
								<strong>Scadenza:</strong> 31 Dicembre 2025
							</p>
							<p>
								<strong>Stato:</strong>
								<span class="status-active">Attivo</span>
							</p>
						</div>
					</div>
				</div>
			</div>
			<div class="profile-actions">
				<a href="#" class="btn btn-outline">Modifica profilo</a>
				<a href="#" class="btn btn-primary">Rinnova tessera</a>
			</div>
		</div>
		</div>
		</section>
		<!-- Footer -->
		<footer class="footer">
			<div class="container">
				<div class="footer-content">
					<div class="footer-section">
						<img src="assets/images/logo.svg" alt="Logo Associazione Santa Barbara APS" class="footer-logo">
						<p>Associazione Santa Barbara APS</p>
						<p>Promuoviamo la cultura e il volontariato nel nostro territorio</p>
					</div>
					<div class="footer-section">
						<h4>Link utili</h4>
						<ul>
							<li>
								<a href="chi-siamo.html">Chi siamo</a>
							</li>
							<li>
								<a href="attivita.html">Attivit√†</a>
							</li>
							<li>
								<a href="eventi.html">Eventi</a>
							</li>
							<li>
								<a href="contatti.html">Contatti</a>
							</li>
						</ul>
					</div>
					<div class="footer-section">
						<h4>Informazioni</h4>
						<ul>
							<li>
								<a href="privacy.html">Privacy Policy</a>
							</li>
							<li>
								<a href="faq.html">FAQ</a>
							</li>
							<li>
								<a href="area-soci.html">Area Soci</a>
							</li>
						</ul>
					</div>
					<div class="footer-section">
						<h4>Seguici</h4>
						<div class="social-links">
							<a href="https://www.facebook.com/santabarbara.grumoappula" class="social-link" aria-label="Facebook">
								<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
									<path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
								</svg>
							</a>
							<a href="https://www.instagram.com/corteostoricosantabarbara/" class="social-link" aria-label="Instagram">
								<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
									<path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
								</svg>
							</a>
							<a href="https://t.me/associazionesbarbara" class="social-link" aria-label="Telegram">
								<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
									<path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
								</svg>
							</a>
						</div>
					</div>
				</div>
				<div class="footer-bottom">
					<p>&copy; 2008- <span id="current-year"></span> Associazione Santa Barbara APS. Tutti i diritti riservati. </p>
				</div>
			</div>
		</footer>
		<script src="assets/js/script.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
		<!-- Supabase Authentication Protection Script -->
		<script>
			// Initialize Supabase
			const {
				createClient
			} = supabase;
			const supabaseClient = createClient('https://ciezrbsolxpjxswdkkpo.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpZXpyYnNvbHhwanhzd2Rra3BvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MjM1NjAsImV4cCI6MjA2ODQ5OTU2MH0.V-U8KhO8byObUW5kJ8XbLBkp9O9Efh98MdbKYFfbQJk');
			// Global variables (currentUser is already declared in script.js)
			let userRole = null;
			// DOM Elements
			const loadingScreen = document.getElementById('loading-screen');
			const loginPrompt = document.getElementById('login-prompt');
			const membersContent = document.getElementById('members-content');
			const userInfo = document.getElementById('user-info');
			const logoutBtn = document.getElementById('logout-btn');
			// Utility Functions
			function showLoading() {
				if (loadingScreen) {
					loadingScreen.style.display = 'flex';
				}
				if (loginPrompt) loginPrompt.style.display = 'none';
				if (membersContent) membersContent.style.display = 'none';
			}

			function hideLoading() {
				if (loadingScreen) {
					loadingScreen.style.display = 'none';
				}
			}

			function showLoginPrompt() {
				hideLoading();
				if (loginPrompt) loginPrompt.style.display = 'block';
				if (membersContent) membersContent.style.display = 'none';
			}

			function showMembersContent() {
				hideLoading();
				if (loginPrompt) loginPrompt.style.display = 'none';
				if (membersContent) {
					membersContent.style.display = 'block';
					membersContent.classList.add('show');
				}
			}

			function updateUserInfo(user, metadata) {
				if (!userInfo) return;
				// Estrai informazioni dall'utente e metadata
				const role = metadata?.role || 'utente';
				const firstName = metadata?.first_name || '';
				const lastName = metadata?.last_name || '';
				const fullName = metadata?.full_name || (firstName && lastName ? `${firstName} ${lastName}` : firstName || lastName || 'Utente');
				const phoneNumber = metadata?.phone_number || metadata?.phone || '';
				const dateOfBirth = metadata?.date_of_birth || '';
				const address = metadata?.address || '';
				const membershipDate = metadata?.membership_date || '';
				const membershipNumber = metadata?.membership_number || '';
				// Calcola giorni dall'ultimo accesso
				const lastSignIn = new Date(user.last_sign_in_at || user.created_at);
				const today = new Date();
				const daysSinceLastAccess = Math.floor((today - lastSignIn) / (1000 * 60 * 60 * 24));
				// Formatta la data di ultimo accesso
				const lastAccessText = daysSinceLastAccess === 0 ? 'Oggi' : daysSinceLastAccess === 1 ? 'Ieri' : `${daysSinceLastAccess} giorni fa`;
				userInfo.innerHTML = `
					
									<div class="user-card">
										<div class="user-avatar">
											<span>${fullName.charAt(0).toUpperCase()}</span>
										</div>
										<div class="user-details">
											<h3>${fullName}</h3>
											<p class="user-email">‚úâÔ∏è ${user.email}</p>
							${phoneNumber ? `
											<p class="user-phone">üìû ${phoneNumber}</p>` : ''}
							
											<span class="user-role ${role}">${role === 'socio' ? 'Socio' : 'Utente'}</span>
										</div>
									</div>
									<div class="user-stats">
										<div class="stat">
											<span class="stat-label">Ultimo accesso</span>
											<span class="stat-value">${lastAccessText}</span>
										</div>
										<div class="stat">
											<span class="stat-label">Stato account</span>
											<span class="stat-value">‚úÖ Attivo</span>
										</div>
						${membershipNumber ? `
						
										<div class="stat">
											<span class="stat-label">N. Tessera</span>
											<span class="stat-value">#${membershipNumber}</span>
										</div>` : ''}
						${membershipDate ? `
						
										<div class="stat">
											<span class="stat-label">Socio dal</span>
											<span class="stat-value">${new Date(membershipDate).toLocaleDateString('it-IT')}</span>
										</div>` : ''}
					
									</div>
					${address || dateOfBirth ? `
					
									<div class="user-additional-info" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2);">
						${address ? `
										<p style="margin-bottom: 10px; opacity: 0.9;">
											<strong>üìç Indirizzo:</strong> ${address}
										</p>` : ''}
						${dateOfBirth ? `
										<p style="margin-bottom: 10px; opacity: 0.9;">
											<strong>üéÇ Data di nascita:</strong> ${new Date(dateOfBirth).toLocaleDateString('it-IT')}
										</p>` : ''}
					
									</div>` : ''}
				`;
			}
			// Authentication Functions
			async function checkAuthentication() {
				showLoading();
				try {
					// Get current session
					const {
						data: {
							session
						},
						error
					} = await supabaseClient.auth.getSession();
					if (error) {
						console.error('Error checking session:', error);
						showLoginPrompt();
						return;
					}
					if (!session || !session.user) {
						// No active session, redirect to login
						setTimeout(() => {
							window.location.href = 'login.html';
						}, 1000);
						return;
					}
					// Check if email is confirmed
					if (!session.user.email_confirmed_at) {
						showLoginPrompt();
						if (loginPrompt) {
							loginPrompt.innerHTML = `
                            
			
			
									<div class="auth-prompt">
										<h2>‚ö†Ô∏è Email non confermata</h2>
										<p>Il tuo account non √® ancora stato confermato.</p>
										<p>Controlla la tua casella di posta e clicca sul link di conferma.</p>
										<div class="auth-actions">
											<button onclick="resendConfirmation()" class="btn btn-primary">Invia di nuovo email</button>
											<a href="login.html" class="btn btn-secondary">Torna al Login</a>
										</div>
									</div>
                        `;
						}
						return;
					}
					// User is authenticated and confirmed
					currentUser = session.user;
					let userMetadata = session.user.user_metadata;
					userRole = userMetadata?.role || 'utente';
					// Try to fetch additional user profile data from profiles table
					try {
						const {
							data: profileData,
							error: profileError
						} = await supabaseClient.from('profiles').select('*').eq('id', session.user.id).single();
						if (!profileError && profileData) {
							// Merge profile data with user metadata
							userMetadata = {
								...userMetadata,
								...profileData
							};
							userRole = profileData.role || userMetadata?.role || 'utente';
						}
					} catch (profileError) {
						console.log('Profile table not found or no additional data:', profileError);
						// Continue with just the metadata from auth
					}
					// Check if user has access (socio role)
					if (userRole !== 'socio') {
						showLoginPrompt();
						if (loginPrompt) {
							loginPrompt.innerHTML = `
                            
			
			
									<div class="auth-prompt">
										<h2>üîí Accesso Limitato</h2>
										<p>Il tuo account √® attivo ma non hai i permessi per accedere all'area soci.</p>
										<p>Contatta l'amministrazione per richiedere l'attivazione come socio.</p>
										<div class="contact-info">
											<p>üìß 
						
						
												<strong>Email:</strong> info@associazionesbarbara.it
					
					
											</p>
											<p>üìç 
						
						
												<strong>Sede:</strong> Via N. Mastroserio 12, Grumo Appula (BA)
					
					
											</p>
										</div>
										<div class="auth-actions">
											<button onclick="handleLogout()" class="btn btn-secondary">Logout</button>
											<a href="index.html" class="btn btn-primary">Torna alla Home</a>
										</div>
									</div>
                        `;
						}
						return;
					}
					// User has access, show members content
					updateUserInfo(currentUser, userMetadata);
					showMembersContent();
				} catch (error) {
					console.error('Authentication check failed:', error);
					showLoginPrompt();
				}
			}
			// Resend confirmation email
			async function resendConfirmation() {
				try {
					const {
						error
					} = await supabaseClient.auth.resend({
						type: 'signup',
						email: currentUser?.email
					});
					if (error) {
						alert('Errore nell\'invio dell\'email: ' + error.message);
					} else {
						alert('Email di conferma inviata! Controlla la tua casella di posta.');
					}
				} catch (error) {
					console.error('Error resending confirmation:', error);
					alert('Errore nell\'invio dell\'email di conferma.');
				}
			}
			// Logout function
			async function handleLogout() {
				try {
					const {
						error
					} = await supabaseClient.auth.signOut();
					if (error) {
						console.error('Logout error:', error);
						alert('Errore durante il logout: ' + error.message);
					} else {
						// Redirect to home page after successful logout
						window.location.href = 'index.html';
					}
				} catch (error) {
					console.error('Logout failed:', error);
					alert('Errore durante il logout.');
				}
			}
			// Auth state change listener
			supabaseClient.auth.onAuthStateChange((event, session) => {
				console.log('Auth state changed:', event, session);
				if (event === 'SIGNED_OUT' || !session) {
					// User signed out or session expired
					window.location.href = 'login.html';
				} else if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {
					// User signed in or token refreshed
					checkAuthentication();
				}
			});
			// Event Listeners
			document.addEventListener('DOMContentLoaded', function() {
				// Add logout button event listener
				if (logoutBtn) {
					logoutBtn.addEventListener('click', handleLogout);
				}
				// Check authentication on page load
				checkAuthentication();
			});
			// Global functions for buttons
			window.resendConfirmation = resendConfirmation;
			window.handleLogout = handleLogout;
		</script>
	</body>
</html>